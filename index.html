<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTODROP | CS2 CASES & UPGRADES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #0b0d11;
            --bg-panel: #14171c;
            --accent: #facc15;
            --accent-hot: #fb7185;
            --rarity-blue: #4b69ff;
            --rarity-purple: #8847ff;
            --rarity-pink: #d32ee6;
            --rarity-red: #eb4b4b;
            --rarity-gold: #ebca44;
        }

        body { font-family: 'Rajdhani', sans-serif; background-color: var(--bg-dark); color: #e2e8f0; overflow-x: hidden; overflow-y: auto; background-image: radial-gradient(circle at 15% -20%, rgba(250,204,21,0.15), transparent 40%), radial-gradient(circle at 80% -10%, rgba(244,114,182,0.13), transparent 35%); }
        .nav-link.active { color: var(--accent); border-bottom: 3px solid var(--accent); text-shadow: 0 0 14px rgba(250,204,21,0.7); }
        .live-drop-scroll { display: flex; gap: 1rem; padding: 0.5rem 0.75rem; width: max-content; will-change: transform; transform: translate3d(0,0,0); }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        
        .live-drop-item { 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(250,204,21,0.25) 0%, rgba(168,85,247,0.15) 100%);
            border-radius: 16px;
            border: 2px solid rgba(250,204,21,0.5);
            min-width: 152px;
            height: 182px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }
        .live-drop-item .live-drop-avatar {
            width: 36px; height:36px; border-radius:9999px; overflow:hidden; border:2px solid rgba(0,0,0,0.4); box-shadow:0 4px 12px rgba(0,0,0,0.5); margin-bottom:4px;
        }
        .live-drop-tooltip {
            position: absolute; left: 50%; transform: translateX(-50%); bottom: calc(100% + 8px);
            background: linear-gradient(180deg, rgba(11,13,17,0.98), rgba(20,23,28,0.98));
            border: 1px solid rgba(250,204,21,0.12); padding: 8px 10px; border-radius: 10px; min-width: 180px; text-align: left; z-index: 200;
            box-shadow: 0 6px 30px rgba(0,0,0,0.6); display: none; pointer-events: none;
        }
        .live-drop-tooltip.visible { display: block; }
        .live-drop-tooltip .tp-row { display:flex; gap:8px; align-items:center; }
        .live-drop-tooltip .tp-avatar { width:48px; height:48px; border-radius:9999px; overflow:hidden; border:2px solid rgba(255,255,255,0.04); }
        .live-drop-tooltip .tp-name { font-weight:800; color:#facc15; font-size:13px; }
        .live-drop-tooltip .tp-when { font-size:12px; color:#cbd5e1; }
        .live-drop-item:hover {
            transform: scale(1.08);
            background: linear-gradient(135deg, rgba(250,204,21,0.5) 0%, rgba(168,85,247,0.3) 100%);
            border-color: rgba(250,204,21,1);
            box-shadow: 0 0 30px rgba(250,204,21,0.6), inset 0 0 20px rgba(250,204,21,0.2);
            animation: none !important;
        }
        .live-drop-item img { max-height: 78px; max-width: 132px; object-fit: contain; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.6)); }
        .live-drop-item-name { font-size: 11px; font-weight: bold; color: #fff; text-align: center; line-height: 1.25; max-width: 136px; word-break: break-word; min-height: 30px; }
        .live-drop-item-user { font-size: 9px; color: #facc15; text-center; font-weight: bold; }
            animation: dropPulse 2s ease-in-out infinite;
        }
        
        @keyframes dropPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #2d3748; border-radius: 10px; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .upgrade-glow { box-shadow: 0 0 40px rgba(168, 85, 247, 0.15); }

        /* Vylep≈°en√© item animace */
        .item-float { animation: none; opacity: 1; transform: scale(1) !important; }
        @keyframes floatItem { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(0px); } }
        
        .item-pulse { animation: itemPulse 2s ease-in-out infinite; }
        @keyframes itemPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.9; } }
        
        .item-shine { animation: shine 3s ease-in-out infinite; }
        @keyframes shine { 0%, 100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0); } 50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.3); } }
        
        .glow-blue { box-shadow: 0 0 20px rgba(75, 105, 255, 0.4); }
        .glow-purple { box-shadow: 0 0 20px rgba(136, 71, 255, 0.4); }
        .glow-pink { box-shadow: 0 0 20px rgba(211, 46, 230, 0.4); }
        .glow-red { box-shadow: 0 0 20px rgba(235, 75, 75, 0.4); }
        .glow-gold { box-shadow: 0 0 20px rgba(235, 202, 68, 0.6); }

        /* Spinner pro bedny */
        .spinner-container {
            position: relative; width: 100%; height: 180px;
            background: linear-gradient(180deg, #101218 0%, #0a0b0e 100%);
            border-radius: 16px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .spinner-track { display: flex; position: absolute; left: 0; height: 100%; align-items: center; will-change: transform; }
        .spinner-item {
            min-width: 140px; height: 140px; margin: 0 4px;
            background: #14171c; border-bottom: 4px solid;
            border-radius: 12px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 10px; position: relative;
            transition: all 0.2s ease;
        }
        .spinner-item img { max-height: 80px; object-fit: contain; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5)); }
        .spinner-selector {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
            background: var(--accent); z-index: 10; transform: translateX(-50%);
            box-shadow: 0 0 20px var(--accent);
        }
        .blur-edges { position: absolute; top: 0; bottom: 0; width: 100px; z-index: 5; pointer-events: none; }
        .blur-left { left: 0; background: linear-gradient(90deg, #0b0d11 0%, transparent 100%); }
        .blur-right { right: 0; background: linear-gradient(270deg, #0b0d11 0%, transparent 100%); }
        .fallback-img { filter: grayscale(1) opacity(0.3); }

        /* Vizu√°ln√≠ efekty V√Ωhry */
        .win-pop { animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .win-glow-rotate { animation: spin 10s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .particle { position: absolute; border-radius: 50%; pointer-events: none; animation: flyOut 1.5s ease-out forwards; }
        @keyframes flyOut { 
            0% { transform: translate(0, 0) scale(1); opacity: 1; } 
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } 
        }

        /* Upgrade efekty */
        .upgrade-shake { animation: shake 0.5s ease-in-out infinite; border-color: #a855f7 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-1deg); } 75% { transform: translateX(5px) rotate(1deg); } }

        /* Spinner polo≈æky - vylep≈°en√© animace */
        .spinner-item {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .spinner-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.8);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "@google/genai": "https://esm.sh/@google/genai@^1.41.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.574.0"
  }
}
</script>
</head>
<body class="h-screen flex flex-col" onclick="initAudio()">

    <div id="win-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/95 backdrop-blur-md transition-all duration-300 opacity-0">
        <div id="win-bg-glow" class="absolute w-[800px] h-[800px] blur-[150px] opacity-40 win-glow-rotate rounded-full"></div>
        
        <div class="text-center relative z-10 w-full max-w-3xl px-8 flex flex-col items-center">
            <h3 class="text-2xl font-black uppercase text-gray-400 tracking-[0.5em] mb-4 animate-pulse">Padlo ti</h3>
            <img id="win-image" class="h-80 object-contain drop-shadow-[0_20px_50px_rgba(0,0,0,0.8)] scale-0 mb-8" src="" alt="Skin">
            <h2 id="win-name" class="text-6xl font-black uppercase italic tracking-tighter text-white drop-shadow-xl mb-2"></h2>
            <div id="win-price" class="text-3xl font-bold text-yellow-400 mb-12 drop-shadow-lg">0.00 EUR</div>
            
            <div class="flex gap-6 justify-center w-full max-w-lg">
                <button id="btn-win-sell" class="flex-1 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-black py-4 rounded-2xl font-black uppercase text-xl transition-all shadow-[0_0_30px_rgba(34,197,94,0.3)] hover:scale-105 active:scale-95">
                    Prodat za <span id="win-sell-price"></span>
                </button>
                <button id="btn-win-keep" class="flex-1 bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-4 rounded-2xl font-black uppercase text-xl transition-all hover:scale-105 active:scale-95">
                    Nechat v invent√°≈ôi
                </button>
            </div>
        </div>
        <div id="particles-container" class="absolute inset-0 pointer-events-none overflow-hidden z-20"></div>
    </div>

    <div class="h-56 bg-gradient-to-r from-yellow-400/10 via-purple-500/5 to-yellow-400/10 border-b border-yellow-400/20 flex items-stretch overflow-visible z-40">
        <div class="flex-shrink-0 bg-gradient-to-r from-yellow-400 to-yellow-500 text-black px-6 h-full flex items-center font-black text-xs uppercase italic mr-4 tracking-widest shadow-[0_0_20px_rgba(250,204,21,0.5)]">
            üî¥ LIVE DROPS
        </div>
        <div class="flex-1 overflow-hidden py-2">
            <div class="flex items-center gap-4 live-drop-scroll" id="live-drops"></div>
        </div>
        <!-- Live chat (simulovan√Ω) -->
        <div id="live-chat" class="mr-6 my-3 w-96 h-48 bg-[#0b0d11]/80 border border-yellow-400/10 rounded-xl p-3 text-sm overflow-hidden shadow-lg hidden lg:flex flex-col">
            <div id="live-chat-messages" class="flex flex-col gap-2 overflow-y-auto flex-1 pr-2 mb-2"></div>
            <div class="flex gap-2">
                <input id="live-chat-input" type="text" maxlength="140" placeholder="Napi≈° zpr√°vu..." class="flex-1 bg-black/40 border border-yellow-400/20 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-yellow-400/60">
                <button id="live-chat-send" class="bg-yellow-400 hover:bg-yellow-500 text-black font-black text-xs px-3 rounded-lg">SEND</button>
            </div>
        </div>
    </div>

    <header class="h-20 bg-gradient-to-r from-[#16191f] via-[#1a1f2e] to-[#16191f] backdrop-blur-md border-b border-yellow-400/30 flex items-center justify-between px-8 z-30 shadow-[0_0_30px_rgba(250,204,21,0.1)]">
        <div class="flex items-center gap-10">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="switchPage('cases')">
                <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center text-black font-black text-2xl rotate-2 group-hover:rotate-0 transition-transform shadow-[0_0_20px_rgba(250,204,21,0.3)] item-pulse">OD</div>
                <div class="flex flex-col leading-tight">
                    <span class="text-3xl font-black italic tracking-tighter">OTO<span class="text-yellow-400">DROP</span></span>
                </div>
            </div>

            <nav class="hidden 2xl:flex items-center gap-6">
                <button onclick="switchPage('cases')" class="nav-link active py-7 px-2 font-bold text-sm uppercase tracking-widest flex items-center gap-2 transition-all hover:text-white hover:scale-110">
                    <i data-lucide="box" class="w-4 h-4"></i> Bedny
                </button>

                <button onclick="openFreeCase()" id="free-case-btn" class="nav-link py-7 px-2 font-bold text-sm uppercase tracking-widest flex items-center gap-2 transition-all hover:text-green-400 hover:scale-110">
                    <i data-lucide="gift" class="w-4 h-4"></i> <span id="free-case-label">FREE CASE</span>
                </button>

                <button onclick="switchPage('upgrade')" class="nav-link py-7 px-2 font-bold text-sm uppercase tracking-widest flex items-center gap-2 transition-all hover:text-white hover:scale-110">
                    <i data-lucide="arrow-up-right" class="w-4 h-4"></i> Upgrade
                </button>
                <button onclick="switchPage('inventory')" class="nav-link py-7 px-2 font-bold text-sm uppercase tracking-widest flex items-center gap-2 transition-all hover:text-white hover:scale-110">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i> Invent√°≈ô
                </button>
            </nav>
        </div>

        <div class="flex items-center gap-6">
            <div class="bg-gradient-to-r from-gray-900/80 to-gray-800/80 px-5 py-2.5 rounded-2xl border border-yellow-400/30 flex items-center gap-4 shadow-[0_0_20px_rgba(250,204,21,0.2)] hover:shadow-[0_0_30px_rgba(250,204,21,0.4)] transition-all">
                <div class="text-right flex items-center gap-3">
                    <div>
                        <div id="balance" class="font-black text-yellow-400 text-xl leading-none">0.00</div>
                        <div id="balance-currency-label" class="text-[9px] text-gray-500 font-bold uppercase tracking-tighter mt-1">Z≈Østatek (EUR)</div>
                    </div>
                    <select id="currency-select" class="bg-[#0b0d11] border border-yellow-400/20 text-sm text-gray-300 rounded-md px-2 py-1" title="Zmƒõnit mƒõnu">
                        <option value="EUR">EUR</option>
                        <option value="USD">USD</option>
                        <option value="CZK">CZK</option>
                    </select>
                </div>
                <div class="w-10 h-10 bg-yellow-400/20 rounded-xl flex items-center justify-center text-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.3)]">
                    <i data-lucide="coins" class="w-6 h-6"></i>
                </div>
            </div>

            <button onclick="claimDailyReward()" id="daily-reward-btn" class="bg-gradient-to-r from-fuchsia-600 to-pink-500 hover:from-fuchsia-500 hover:to-pink-400 text-white px-4 py-3 rounded-xl font-black transition-all uppercase text-xs border border-pink-300/40 shadow-[0_0_25px_rgba(236,72,153,0.35)] active:scale-95 hover:scale-105">
                üéÅ DAILY ODMƒöNA
            </button>
            <button onclick="addFreeMoney()" class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white px-4 py-3 rounded-xl font-black transition-all uppercase text-xs border border-green-400/50 shadow-[0_0_20px_rgba(34,197,94,0.3)] active:scale-95 hover:scale-105">
                üí∞ + PEN√çZE ZDARMA
            </button>
            <button onclick="openAuthModal()" id="auth-open-btn" class="bg-gradient-to-r from-yellow-400 to-yellow-300 hover:from-yellow-300 hover:to-yellow-200 text-black px-4 py-3 rounded-xl font-black transition-all uppercase text-xs border border-yellow-200/60 shadow-[0_0_26px_rgba(250,204,21,0.42)] active:scale-95 hover:scale-105 flex items-center gap-2">
                <i data-lucide="user-round" class="w-4 h-4"></i>
                <span id="auth-open-label">P≈ôihl√°sit</span>
            </button>
            <div id="profile-pill" class="hidden items-center gap-2 bg-black/35 border border-yellow-300/25 rounded-xl px-3 py-2">
                <img id="profile-pill-avatar" src="" alt="avatar" class="w-8 h-8 rounded-full object-cover border border-yellow-300/40">
                <div class="leading-tight">
                    <div id="profile-pill-name" class="text-xs text-white font-black"></div>
                    <div id="profile-pill-nick" class="text-[10px] text-yellow-300 font-bold"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <main class="flex-1 overflow-y-auto bg-[#0b0d11] relative p-8">
            
            <section id="page-cases" class="page fade-in max-w-7xl mx-auto space-y-10">
                <div class="relative h-[250px] rounded-[32px] overflow-hidden bg-gradient-to-r from-yellow-500/25 via-pink-500/10 to-[#0b0d11] border border-yellow-400/30 shadow-[0_0_80px_rgba(250,204,21,0.16)] flex items-center px-12 mb-8">
                    <div class="absolute inset-0 opacity-0 hover:opacity-5 transition-opacity" style="background: radial-gradient(circle at 30% 50%, yellow, transparent);"></div>
                    <div class="relative z-10 max-w-2xl space-y-4">
                        <div class="inline-block px-4 py-1.5 bg-yellow-400 text-black font-black text-[10px] uppercase tracking-[0.3em] rounded-full italic drop-shadow-lg">ROZ≈†√ç≈òEN√Å DATAB√ÅZE</div>
                        <h1 class="text-5xl font-black uppercase italic tracking-tighter text-white leading-tight drop-shadow-lg">V√çTEJ NA <span class="text-yellow-400">OTODROP</span></h1>
                        <p class="text-gray-400 text-md font-medium leading-relaxed drop-shadow-md">Otev≈ôi bedny se zvukem asmr tik√°n√≠, hrej mini-hry nebo pou≈æij 3-slotov√Ω Upgrader a z√≠skej sv≈Øj vysnƒõn√Ω knife! üíé</p>
                    </div>
                    <i data-lucide="boxes" class="absolute right-10 top-1/2 -translate-y-1/2 w-80 h-80 text-yellow-400/10 animate-pulse"></i><i data-lucide="coins" class="absolute right-20 top-10 w-10 h-10 text-yellow-300/70 drop-shadow-[0_0_14px_rgba(250,204,21,0.8)] animate-bounce"></i><i data-lucide="gem" class="absolute right-36 bottom-10 w-9 h-9 text-pink-400/80 drop-shadow-[0_0_14px_rgba(244,114,182,0.8)]"></i>
                </div>
                <div class="bg-[#14171c]/80 border border-yellow-400/20 rounded-2xl p-4 flex flex-wrap items-center justify-between gap-3 mb-4"><div class="text-xs uppercase tracking-widest font-black text-gray-400">≈òazen√≠ beden</div><div class="flex items-center gap-2"><select id="cases-sort" class="bg-[#0b0d11] border border-yellow-400/30 text-sm text-white rounded-lg px-3 py-2" onchange="renderCases()"><option value="default">Doporuƒçen√©</option><option value="price-asc">Cena: nejni≈æ≈°√≠</option><option value="price-desc">Cena: nejvy≈°≈°√≠</option><option value="name">N√°zev A-Z</option></select><button onclick="toggleAffordableCases()" id="cases-affordable-btn" class="bg-yellow-400/10 hover:bg-yellow-400/20 border border-yellow-400/30 text-yellow-300 rounded-lg px-3 py-2 text-xs font-black uppercase">Jen dostupn√©</button></div></div><div class="space-y-8" id="cases-grid"></div>
            </section>



            <section id="page-case-view" class="page hidden fade-in max-w-6xl mx-auto space-y-8">
                <button onclick="switchPage('cases')" class="text-gray-500 hover:text-white flex items-center gap-2 font-bold uppercase text-xs tracking-widest transition-colors">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Zpƒõt na bedny
                </button>

                <div class="bg-[#14171c] rounded-3xl border border-white/5 p-8 shadow-2xl text-center">
                    <div>
                        <h2 id="view-case-name" class="text-5xl font-black uppercase italic tracking-tighter text-white drop-shadow-xl">Bedna</h2>
                        <div id="view-case-price" class="text-yellow-400 font-bold text-xl mt-2 mb-8">0.00 EUR</div>
                    </div>

                    <div id="spinner-stack" class="space-y-4 mb-8">
                        <div class="spinner-container relative" data-spin-row="0">
                            <div class="blur-edges blur-left"></div>
                            <div class="blur-edges blur-right"></div>
                            <div class="spinner-selector"></div>
                            <div id="spinner-track-0" class="spinner-track"></div>
                        </div>
                    </div>
                    <div id="spin-results" class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8"></div>

                    <div class="flex flex-wrap gap-3 justify-center items-center">
                        <label for="open-count" class="text-xs font-black uppercase tracking-widest text-purple-300">Poƒçet spin≈Ø</label>
                        <select id="open-count" class="bg-[#0b0d11] border border-purple-500/40 text-white rounded-xl px-4 py-3 font-black">
                            <option value="1">1x</option>
                            <option value="2">2x</option>
                            <option value="3">3x</option>
                            <option value="4">4x</option>
                            <option value="5">5x</option>
                        </select>
                        <button id="btn-open-case" class="bg-yellow-400 hover:bg-yellow-500 text-black px-16 py-5 rounded-2xl font-black uppercase italic transition-all hover:scale-105 active:scale-95 shadow-[0_0_30px_rgba(250,204,21,0.3)] text-2xl tracking-tighter">
                            OTEV≈ò√çT BEDNU
                        </button>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-black uppercase italic tracking-tighter text-white mb-4 border-b border-white/10 pb-2">Obsah bedny a ≈°ance</h3>
                    <div id="view-case-contents" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"></div>
                </div>
            </section>

            <section id="page-upgrade" class="page hidden max-w-6xl mx-auto space-y-10 fade-in">
                <div class="text-center">
                    <h2 class="text-5xl font-black uppercase italic tracking-tighter text-white">OTODROP <span class="text-purple-500">UPGRADER</span></h2>
                    <p class="text-gray-500 font-bold text-xs uppercase tracking-widest mt-1">Slo≈æ a≈æ 3 skiny dohromady a vyber si cokoliv z datab√°ze</p>
                </div>
                
                <div class="bg-[#14171c] p-10 rounded-3xl border border-white/5 shadow-2xl relative upgrade-glow" id="upgrade-panel">
                    <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-12 items-center">
                        <div class="space-y-4">
                            <h3 class="text-gray-400 font-black uppercase text-sm tracking-widest text-center mb-2">Tvoje skiny (A≈æ 3)</h3>
                            <div class="flex flex-col gap-3" id="upg-inputs-container"></div>
                            <div class="text-center mt-2">
                                <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Celkov√° hodnota vkladu:</span>
                                <div id="upg-total-input-val" class="text-purple-400 font-black text-xl drop-shadow-lg">0.00 EUR</div>
                            </div>
                        </div>
                        
                        <div class="text-center space-y-6">
                            <div class="relative">
                                <svg class="w-48 h-48 mx-auto transform -rotate-90">
                                    <circle cx="96" cy="96" r="86" stroke="#1f2937" stroke-width="12" fill="transparent" />
                                    <circle id="upgrade-circle" cx="96" cy="96" r="86" stroke="#a855f7" stroke-width="12" fill="transparent" stroke-dasharray="540" stroke-dashoffset="540" class="transition-all duration-1000 ease-out drop-shadow-lg" />
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center flex-col">
                                    <span id="upgrade-chance" class="text-5xl font-black text-white italic drop-shadow-lg">0%</span>
                                    <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">≈†ance</span>
                                </div>
                            </div>
                            <button onclick="attemptUpgrade()" id="btn-upgrade-exec" class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-black py-5 rounded-2xl uppercase italic shadow-lg shadow-purple-500/30 active:scale-95 transition-all tracking-tighter text-xl">
                                Vylep≈°it
                            </button>
                        </div>
                        
                        <div class="space-y-4 h-full flex flex-col justify-center">
                            <h3 class="text-gray-400 font-black uppercase text-sm tracking-widest text-center mb-2">C√≠lov√Ω skin</h3>
                            <div id="upg-target-slot" onclick="openSelector('target')" class="bg-gradient-to-b from-purple-950/30 to-black/30 border-2 border-dashed border-purple-500/50 hover:border-yellow-400 rounded-3xl h-64 flex flex-col items-center justify-center p-4 relative overflow-hidden cursor-pointer transition-all group">
                                <i data-lucide="search" class="w-10 h-10 text-purple-500/50 group-hover:text-yellow-400 mb-2 transition-colors"></i>
                                <span class="text-gray-500 font-bold uppercase text-xs text-center group-hover:text-white transition-colors">Vyber c√≠l z<br>datab√°ze</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="page-inventory" class="page hidden max-w-7xl mx-auto space-y-8 fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4 border-b border-white/5 pb-6">
                    <div>
                        <h2 class="text-4xl font-black uppercase italic tracking-tighter text-white">M≈ÆJ <span class="text-yellow-400">INVENT√Å≈ò</span></h2>
                        <p id="inv-stats" class="text-gray-500 font-bold text-xs uppercase tracking-widest mt-1">0 p≈ôedmƒõt≈Ø v hodnotƒõ 0.00 EUR</p>
                    </div>
                    <div class="flex gap-2">
                        <select id="inv-filter" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white font-bold text-sm uppercase cursor-pointer" onchange="filterInventory()">
                            <option value="all">V≈°echny</option>
                            <option value="blue">Modr√©</option>
                            <option value="purple">Fialov√©</option>
                            <option value="pink">R≈Ø≈æov√©</option>
                            <option value="red">ƒåerven√©</option>
                            <option value="gold">Zlat√©</option>
                            <option value="knives">No≈æe</option>
                        </select>
                        <select id="inv-sort" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white font-bold text-sm uppercase cursor-pointer" onchange="sortInventory()">
                            <option value="newest">Nejnovƒõj≈°√≠</option>
                            <option value="price-high">Cena (vysok√°)</option>
                            <option value="price-low">Cena (n√≠zk√°)</option>
                            <option value="name">Jm√©no (A-Z)</option>
                        </select>
                        <button onclick="sellAllSkins()" class="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white px-6 py-2 rounded-lg font-bold text-xs transition-all border border-red-500/20 uppercase tracking-widest">
                            Prodat v≈°e
                        </button>
                    </div>
                </div>
                <div id="inventory-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"></div>
            </section>

            <section id="page-selector" class="page hidden max-w-7xl mx-auto space-y-8 fade-in">
                <div class="flex items-center justify-between border-b border-white/10 pb-6">
                    <div>
                        <button onclick="switchPage('upgrade')" class="text-gray-500 hover:text-white flex items-center gap-2 font-bold uppercase text-xs tracking-widest transition-colors mb-2">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> Zpƒõt do Upgraderu
                        </button>
                        <h2 id="selector-title" class="text-4xl font-black uppercase italic tracking-tighter text-white">VYBER SKIN</h2>
                    </div>
                </div>
                <div class="flex justify-end"><select id="selector-sort" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-bold text-xs uppercase" onchange="openSelector(window.currentSelectorType || 'input', window.currentSelectorSlot || 0)"><option value="price-low">Cena: nejni≈æ≈°√≠</option><option value="price-high">Cena: nejvy≈°≈°√≠</option><option value="name">Jm√©no A-Z</option></select></div><div id="selector-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"></div>
            </section>

        </main>
    </div>

    <div id="auth-modal" class="fixed inset-0 z-[110] hidden items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="w-full max-w-lg bg-[#131824] border border-yellow-400/30 rounded-3xl p-6 shadow-[0_0_60px_rgba(250,204,21,0.18)]">
            <div class="flex items-center justify-between mb-5">
                <h3 class="text-2xl font-black uppercase italic tracking-tighter text-white">P≈ôihl√°≈°en√≠ / Profil</h3>
                <button onclick="closeAuthModal()" class="text-gray-500 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
                <a href="http://localhost:3000/auth/steam" target="_blank" class="bg-[#1b2838] hover:bg-[#223a52] text-white rounded-xl px-4 py-3 font-black text-sm uppercase text-center border border-blue-300/20">Steam Login</a>
                <a href="http://localhost:3000/auth/google" target="_blank" class="bg-white/90 hover:bg-white text-black rounded-xl px-4 py-3 font-black text-sm uppercase text-center border border-white/30">Google Login</a>
            </div>
            <p class="text-[11px] text-gray-400 mb-4">Bez backendu m≈Ø≈æe≈° pou≈æ√≠t lok√°ln√≠ demo profil n√≠≈æe.</p>
            <div class="space-y-3">
                <input id="profile-nickname" type="text" maxlength="24" placeholder="Nickname" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-display-name" type="text" maxlength="32" placeholder="Display jm√©no" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-avatar" type="url" placeholder="URL profilov√© fotky" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <div class="flex gap-3 pt-1">
                    <button onclick="saveLocalProfile()" class="flex-1 bg-yellow-400 hover:bg-yellow-500 text-black font-black uppercase rounded-xl py-3">Ulo≈æit profil</button>
                    <button onclick="logoutLocalProfile()" class="flex-1 bg-red-500/20 hover:bg-red-500 text-red-300 hover:text-white font-black uppercase rounded-xl py-3 border border-red-400/40">Odhl√°sit</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 right-10 bg-yellow-400 text-black px-8 py-4 rounded-2xl font-black shadow-2xl opacity-0 transform translate-y-10 transition-all duration-300 z-[100] uppercase italic tracking-tighter text-lg border-2 border-yellow-300">
        Akce √∫spƒõ≈°n√°!
    </div>

    <script>
        const FALLBACK_IMG = "https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot7HxfDhjx2jJemkV09-5lpS0lfL3D7fQmGRu58ByiOXO89Wj2Vbtr0BkZmmhcI7HclM4M1vXq1LtxLrugcG8tZ7IznFr6SIn43_D30vgT85F9rU";
        function handleImgError(img) {
            // Pokusit se postupnƒõ pou≈æ√≠t alternativn√≠ URL ulo≈æen√© v data-alts (pipe-separated)
            try {
                const alts = (img.dataset.alts || '').split('|').filter(Boolean);
                if(alts.length > 0) {
                    img.onerror = null;
                    img.src = alts.shift();
                    img.dataset.alts = alts.join('|');
                    img.onerror = handleImgError;
                    return;
                }
            } catch(e) { /* ignore */ }
            img.onerror = null;
            img.src = FALLBACK_IMG;
            img.classList.add('fallback-img');
        }
    </script>

    <script>
        // --- AUDIO ENGINE (Web Audio API) ---
        let audioCtx;
        let audioInitialized = false;

        function initAudio() {
            if(!audioInitialized) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioInitialized = true;
            } else if(audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        const SoundEngine = {
            playTick: () => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.03);
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.03);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.03);
            },
            playWin: (rarity) => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'square';
                
                let baseFreq = rarity === 'gold' ? 523.25 : (rarity === 'red' ? 440 : 329.63); // C5, A4, E4
                osc.frequency.setValueAtTime(baseFreq, audioCtx.currentTime);
                osc.frequency.setValueAtTime(baseFreq * 1.25, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(baseFreq * 1.5, audioCtx.currentTime + 0.2);
                
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 1.5);
            },
            playUpgradeProcess: () => {
                if(!audioCtx) return null;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 2); // stoup√° 2 sekundy
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                osc.start();
                return { osc, gain };
            },
            playUpgradeFail: () => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        };

        // --- STAV A DATAB√ÅZE ---
        let balanceBase = 100.00;
        const KNIFE_TYPES = ["Bayonet", "Bowie Knife", "Butterfly Knife", "Classic Knife", "Falchion Knife", "Flip Knife", "Gut Knife", "Huntsman Knife", "Karambit", "M9 Bayonet", "Navaja Knife", "Nomad Knife", "Paracord Knife", "Shadow Daggers", "Skeleton Knife", "Stiletto Knife", "Survival Knife", "Talon Knife", "Ursus Knife"];

        // 300+ RE√ÅLN√ùCH SKIN≈Æ - KOMPLETN√ç DATAB√ÅZE CS2
        const rawSkinData = `
P250|Sand Dune|0.10|#b0c3d9
Glock-18|Catacombs|0.20|#4b69ff
SSG 08|Abyss|0.50|#4b69ff
P90|Grim|0.80|#4b69ff
M4A4|Magnesium|1.00|#4b69ff
MAC-10|Candy Apple|1.10|#5e98d9
Glock-18|Weasel|1.20|#8847ff
Glock-18|Moonrise|1.50|#8847ff
USP-S|Ticket to Hell|1.80|#8847ff
P250|Asiimov|2.00|#d32ee6
AK-47|Elite Build|2.50|#4b69ff
M4A1-S|Night Terror|2.50|#8847ff
AWP|Worm God|3.00|#8847ff
USP-S|Cyrex|3.50|#8847ff
AK-47|Slate|4.00|#8847ff
Desert Eagle|Light Rail|4.00|#8847ff
AWP|Mortis|4.50|#d32ee6
Glock-18|Water Elemental|5.00|#d32ee6
USP-S|Cortex|5.00|#d32ee6
Desert Eagle|Conspiracy|6.00|#d32ee6
AK-47|Phantom Disruptor|6.00|#d32ee6
Desert Eagle|Mecha Industries|7.00|#d32ee6
MAC-10|Neon Rider|8.00|#eb4b4b
AWP|Atheris|10.00|#8847ff
M4A4|Desolate Space|10.00|#d32ee6
Glock-18|Bullet Queen|12.00|#eb4b4b
FAMAS|Commemoration|12.00|#eb4b4b
M4A1-S|Decimator|14.00|#d32ee6
AK-47|Redline|15.00|#d32ee6
Glock-18|Neo-Noir|15.00|#eb4b4b
M4A4|In Living Color|15.00|#eb4b4b
AK-47|Ice Coaled|18.00|#d32ee6
USP-S|Neo-Noir|18.00|#eb4b4b
M4A4|Neo-Noir|20.00|#eb4b4b
AWP|Neo-Noir|25.00|#eb4b4b
USP-S|Orion|25.00|#d32ee6
M4A1-S|Hyper Beast|25.00|#eb4b4b
M4A4|The Emperor|30.00|#eb4b4b
AK-47|Asiimov|35.00|#eb4b4b
M4A1-S|Player Two|35.00|#eb4b4b
AK-47|Neon Rider|40.00|#eb4b4b
USP-S|Kill Confirmed|45.00|#eb4b4b
USP-S|Printstream|55.00|#eb4b4b
Desert Eagle|Printstream|60.00|#eb4b4b
AK-47|Bloodsport|75.00|#eb4b4b
AK-47|Vulcan|80.00|#eb4b4b
AWP|Containment Breach|85.00|#eb4b4b
AWP|Asiimov|110.00|#eb4b4b
M4A1-S|Printstream|210.00|#eb4b4b
Desert Eagle|Emerald J√∂rmungandr|350.00|#8847ff
Bayonet|Slaughter|450.00|#ebca44
M4A1-S|Blue Phosphor|700.00|#d32ee6
Glock-18|Fade|800.00|#8847ff
Desert Eagle|Blaze|900.00|#8847ff
M9 Bayonet|Doppler|900.00|#ebca44
Talon Knife|Fade|1000.00|#ebca44
Karambit|Tiger Tooth|1000.00|#ebca44
Karambit|Doppler|1100.00|#ebca44
Karambit|Fade|1200.00|#ebca44
M9 Bayonet|Lore|1200.00|#ebca44
Driver Gloves|King Snake|1200.00|#ebca44
Karambit|Marble Fade|1300.00|#ebca44
Butterfly Knife|Slaughter|1400.00|#ebca44
Karambit|Lore|1500.00|#ebca44
M9 Bayonet|Autotronic|1500.00|#ebca44
Butterfly Knife|Doppler|1600.00|#ebca44
Skeleton Knife|Crimson Web|1600.00|#ebca44
Butterfly Knife|Tiger Tooth|1700.00|#ebca44
M9 Bayonet|Crimson Web|1800.00|#ebca44
Skeleton Knife|Fade|1800.00|#ebca44
Butterfly Knife|Marble Fade|2000.00|#ebca44
Sport Gloves|Vice|2000.00|#ebca44
Butterfly Knife|Fade|2200.00|#ebca44
M4A1-S|Welcome to the Jungle|2500.00|#eb4b4b
AWP|Medusa|3000.00|#eb4b4b
AK-47|Gold Arabesque|3000.00|#eb4b4b
M4A4|Howl|3500.00|#e4ae39
Sport Gloves|Pandora's Box|4000.00|#ebca44
AK-47|Wild Lotus|4500.00|#eb4b4b
AWP|Dragon Lore|5000.00|#eb4b4b
AWP|Gungnir|6000.00|#eb4b4b
Flip Knife|Marble Fade|1950.00|#ebca44
Gut Knife|Tiger Tooth|750.00|#ebca44
Huntsman Knife|Slaughter|950.00|#ebca44
Bowie Knife|Lore|1100.00|#ebca44
Falchion Knife|Fade|1100.00|#ebca44
Shadow Daggers|Crimson Web|1250.00|#ebca44
Stiletto Knife|Fade|1200.00|#ebca44
Ursus Knife|Doppler|1300.00|#ebca44
Moto Gloves|Spearmint|2200.00|#ebca44
Specialist Gloves|Crimson Kimono|2300.00|#ebca44
Hand Wraps|Slaughter|2100.00|#ebca44
AK-47|Uncharted|42.00|#4b69ff
M4A4|Royal Paladin|45.00|#eb4b4b
Desert Eagle|Hand Cannon|38.00|#8847ff
P250|Whiteout|2.50|#4b69ff
USP-S|Whiteout|2.75|#4b69ff
M4A4|Converter|3.00|#4b69ff
AK-47|Point Disarray|11.00|#d32ee6
M4A1-S|Icarus Fell|16.50|#8847ff
Glock-18|Candy Apple|3.50|#4b69ff
M4A1-S|Dark Water|4.00|#8847ff
USP-S|Dark Water|3.75|#8847ff
AWP|Oni Taiji|19.50|#eb4b4b
Desert Eagle|Kumicho Dragon|35.00|#d32ee6
M4A4|ÈæçÁéã (Dragon King)|22.50|#d32ee6
AK-47|Legion of Anubis|28.00|#eb4b4b
Glock-18|Dragon Tattoo|8.50|#8847ff
P90|Elite Build|2.75|#4b69ff
MAC-10|Disco Tech|3.25|#d32ee6
UMP-45|Scaffold|2.50|#8847ff
Nova|Graphite|1.50|#8847ff
FAMAS|Valence|4.00|#8847ff
Galil AR|Chromatic Aberration|5.50|#d32ee6
SG 553|Phantom|6.00|#8847ff
Five-SeveN|Nightshade|3.75|#4b69ff
Dual Berettas|Ventilators|4.50|#4b69ff
R8 Revolver|Fade|7.00|#eb4b4b
Tec-9|Blast From the Past|3.00|#4b69ff
XM1014|Heaven Guard|2.50|#8847ff
Negev|Loudmouth|2.00|#8847ff
M4A1-S|Atomic Alloy|5.50|#d32ee6
M4A1-S|Guardian|6.00|#d32ee6
M4A1-S|Golden Coil|8.50|#eb4b4b
M4A1-S|Basilisk|7.00|#8847ff
M4A4|Tooth Fairy|4.00|#d32ee6
M4A4|Poly Mag|5.00|#4b69ff
M4A4|Asiimov|9.00|#eb4b4b
M4A4|Temukau|8.00|#eb4b4b
AK-47|Uncharted|12.00|#4b69ff
AK-47|Bloodsport|15.00|#eb4b4b
AK-47|Neon Rider|18.00|#eb4b4b
AK-47|Point Disarray|8.00|#d32ee6
AK-47|Phantom Disruptor|6.00|#d32ee6
AK-47|Phantom Disruptor|7.00|#d32ee6
AK-47|Neon Rider|20.00|#eb4b4b
AWP|Containment Breach|32.00|#eb4b4b
AWP|Corticera|8.00|#d32ee6
AWP|Hyper Beast|22.00|#eb4b4b
AWP|Oni Taiji|15.00|#eb4b4b
AWP|Phobos|6.00|#8847ff
AWP|Redline|25.00|#d32ee6
AWP|Pink DDPAT|12.00|#8847ff
AWP|Man-o'-war|18.00|#eb4b4b
AWP|Graphite|14.00|#d32ee6
USP-S|Serum|5.00|#d32ee6
USP-S|Caiman|6.50|#d32ee6
USP-S|Overgrowth|4.00|#8847ff
USP-S|Road Rash|5.50|#8847ff
Desert Eagle|Code Red|8.00|#eb4b4b
Desert Eagle|Directive|7.50|#8847ff
Desert Eagle|Mudder|4.00|#5e98d9
Desert Eagle|Fennec Fox|9.00|#d32ee6
Glock-18|Reactor|4.00|#4b69ff
Glock-18|Snack Attack|3.00|#d32ee6
P250|Mehndi|3.00|#d32ee6
P250|Contaminant|2.00|#4b69ff
P250|Supernova|6.00|#8847ff
P250|Franklin|4.50|#d32ee6
Flip Knife|Tiger Tooth|600.00|#ebca44
Flip Knife|Doppler|700.00|#ebca44
Flip Knife|Slaughter|750.00|#ebca44
Flip Knife|Fade|800.00|#ebca44
Flip Knife|Case Hardened|850.00|#ebca44
Flip Knife|Marble Fade|950.00|#ebca44
Gut Knife|Fade|550.00|#ebca44
Gut Knife|Doppler|600.00|#ebca44
Gut Knife|Slaughter|650.00|#ebca44
Gut Knife|Case Hardened|700.00|#ebca44
Huntsman Knife|Tiger Tooth|700.00|#ebca44
Huntsman Knife|Fade|800.00|#ebca44
Huntsman Knife|Doppler|850.00|#ebca44
Huntsman Knife|Marble Fade|900.00|#ebca44
Nomad Knife|Fade|1100.00|#ebca44
Bowie Knife|Tiger Tooth|800.00|#ebca44
Bowie Knife|Fade|900.00|#ebca44
Bowie Knife|Doppler|950.00|#ebca44
Classic Knife|Fade|1000.00|#ebca44
Falchion Knife|Tiger Tooth|750.00|#ebca44
Falchion Knife|Fade|850.00|#ebca44
Falchion Knife|Doppler|900.00|#ebca44
Paracord Knife|Fade|700.00|#ebca44
Shadow Daggers|Tiger Tooth|750.00|#ebca44
Shadow Daggers|Fade|850.00|#ebca44
Shadow Daggers|Doppler|900.00|#ebca44
Stiletto Knife|Tiger Tooth|800.00|#ebca44
Stiletto Knife|Marble Fade|950.00|#ebca44
Survival Knife|Fade|700.00|#ebca44
Talon Knife|Tiger Tooth|950.00|#ebca44
Talon Knife|Marble Fade|1050.00|#ebca44
Talon Knife|Doppler|1000.00|#ebca44
Ursus Knife|Tiger Tooth|1000.00|#ebca44
Ursus Knife|Fade|1100.00|#ebca44
Ursus Knife|Marble Fade|1200.00|#ebca44
Navaja Knife|Tiger Tooth|850.00|#ebca44
Navaja Knife|Fade|950.00|#ebca44
Navaja Knife|Doppler|1000.00|#ebca44
Driver Gloves|Crimson Weave|1000.00|#ebca44
Specialist Gloves|Mogul|1050.00|#ebca44
Sport Gloves|Arid|1000.00|#ebca44
Sport Gloves|Superconductor|1150.00|#ebca44
Specialist Gloves|Tiger Strike|1050.00|#ebca44
Specialist Gloves|Emerald Web|1100.00|#ebca44
Specialist Gloves|Forest DDPAT|950.00|#ebca44
Hand Wraps|Badlands|1000.00|#ebca44
Hand Wraps|Cobalt Skulls|1100.00|#ebca44
Moto Gloves|Eclipse|1000.00|#ebca44
Moto Gloves|Polygon|1050.00|#ebca44
Moto Gloves|Blood Pressure|1100.00|#ebca44
Broken Fang Gloves|Needle Point|950.00|#ebca44
M4A1-S|Emphorosaur-S|8.00|#8847ff
M4A1-S|Nightmare|9.00|#d32ee6
M4A1-S|Blue Phosphor|12.00|#d32ee6
AWP|Gungnir|150.00|#eb4b4b
AWP|Dragon Lore|200.00|#eb4b4b
AWP|Medusa|120.00|#eb4b4b
AWP|Fade|95.00|#eb4b4b
AWP|Oni Taiji|35.00|#eb4b4b
AK-47|Gold Arabesque|95.00|#eb4b4b
AK-47|Wild Lotus|150.00|#eb4b4b
AK-47|Uncharted|50.00|#4b69ff
AK-47|Phantom Disruptor|12.00|#d32ee6
AK-47|Bloodsport|45.00|#eb4b4b
Karambit|Lore|800.00|#ebca44
Karambit|Autotronic|750.00|#ebca44
Karambit|Case Hardened|900.00|#ebca44
Karambit|Crimson Web|1100.00|#ebca44
M9 Bayonet|Lore|850.00|#ebca44
M9 Bayonet|Autotronic|800.00|#ebca44
M9 Bayonet|Case Hardened|950.00|#ebca44
Butterfly Knife|Autotronic|900.00|#ebca44
Butterfly Knife|Case Hardened|1050.00|#ebca44
Butterfly Knife|Crimson Web|1200.00|#ebca44`;

        const skinsDB = {};
        const GLOVE_TYPES = ["Driver Gloves", "Sport Gloves", "Specialist Gloves", "Hand Wraps", "Moto Gloves", "Broken Fang Gloves", "Hydra Gloves"];
        
        rawSkinData.trim().split("\n").forEach((line, idx) => {
            const parts = line.split("|");
            if(parts.length < 4) return;
            const w = parts[0].trim();
            const c = parts[parts.length - 1].trim();
            const p = parts[parts.length - 2].trim();
            const n = parts.slice(1, parts.length - 2).join("|").trim();
            let folder = "skins";
            if(GLOVE_TYPES.includes(w)) folder = "gloves";
            else if(KNIFE_TYPES.includes(w)) folder = "knives";
            
            const imgOverrides = {
                "AWP|Man-o'-war": "https://www.csgodatabase.com/images/skins/webp/AWP_Man-o'-war.webp",
                "M4A4|ÈæçÁéã (Dragon King)": "https://www.csgodatabase.com/images/skins/webp/M4A4_%E9%BE%8D%E7%8E%8B_(Dragon_King).webp",
                "Driver Gloves|Crimson Weave": "https://www.csgodatabase.com/images/gloves/webp/Driver_Gloves_Crimson_Weave.webp",
                "Broken Fang Gloves|Needle Point": "https://www.csgodatabase.com/images/gloves/webp/Broken_Fang_Gloves_Needle_Point.webp",
                "Sport Gloves|Pandora's Box": "https://www.csgodatabase.com/images/gloves/webp/Sport_Gloves_Pandora's_Box.webp"
            };

            let urlWeapon = w.replace(/ /g, "_");
            let urlName = n.replace(/ /g, "_").replace(/'/g, "");
            const overrideKey = `${w}|${n}`;
            const primaryImg = imgOverrides[overrideKey] || `https://www.csgodatabase.com/images/${folder}/webp/${urlWeapon}_${urlName}.webp`;
            // Alternate patterns (some gloves/rare items have different naming on CDN)
            const alt1 = `https://www.csgodatabase.com/images/${folder}/webp/${urlName}.webp`;
            const alt2 = primaryImg.replace('/webp/', '/').replace('.webp', '.png');
            skinsDB[idx + 1] = {
                id: idx + 1,
                weapon: w,
                skinName: n,
                name: `${w} | ${n}`,
                price: parseFloat(p),
                color: c,
                img: primaryImg,
                imgAlts: [alt1, alt2],
                rarityName: c === '#ebca44' ? 'gold' : (c === '#eb4b4b' ? 'red' : (c === '#d32ee6' ? 'pink' : 'blue'))
            };
        });

        function normalizeName(v) {
            return (v || '').toLowerCase().replace(/[‚Äô']/g, '').replace(/[^a-z0-9]+/g, ' ').trim();
        }

        function findSkin(w, n) {
            const exact = Object.values(skinsDB).find(s => s.weapon === w && s.skinName === n);
            if(exact) return exact;
            const nw = normalizeName(w);
            const nn = normalizeName(n);
            return Object.values(skinsDB).find(s => normalizeName(s.weapon) === nw && normalizeName(s.skinName) === nn) || Object.values(skinsDB)[0];
        }

        const casesDB = [];
        setTimeout(() => {
            casesDB.push(
                {
                    id: "trash-or-knife", name: "1% KNIFE Risk", price: 25.00, color: "yellow-400",
                    img: findSkin("M9 Bayonet", "Autotronic").img,
                    contents: [
                        { skin: findSkin("P250", "Sand Dune"), chance: 99.0 },
                        { skin: findSkin("M9 Bayonet", "Autotronic"), chance: 1.0 }
                    ]
                },
                {
                    id: "coinflip", name: "50/50 Profit", price: 50.00, color: "red",
                    img: findSkin("AK-47", "Bloodsport").img,
                    contents: [
                        { skin: findSkin("AK-47", "Slate"), chance: 50.0 },
                        { skin: findSkin("AK-47", "Bloodsport"), chance: 50.0 }
                    ]
                },
                {
                    id: "budget", name: "Budget Grinder", price: 5.00, color: "blue",
                    img: findSkin("AWP", "Worm God").img,
                    contents: [
                        { skin: findSkin("Glock-18", "Catacombs"), chance: 60.0 },
                        { skin: findSkin("USP-S", "Ticket to Hell"), chance: 25.0 },
                        { skin: findSkin("AWP", "Mortis"), chance: 12.0 },
                        { skin: findSkin("M4A4", "Desolate Space"), chance: 2.5 },
                        { skin: findSkin("AK-47", "Redline"), chance: 0.5 }
                    ]
                },
                {
                    id: "covert", name: "Covert Dreams", price: 100.00, color: "red",
                    img: findSkin("AWP", "Asiimov").img,
                    contents: [
                        { skin: findSkin("M4A4", "The Emperor"), chance: 65.0 },
                        { skin: findSkin("AK-47", "Vulcan"), chance: 25.0 },
                        { skin: findSkin("AWP", "Asiimov"), chance: 8.0 },
                        { skin: findSkin("Desert Eagle", "Emerald J√∂rmungandr"), chance: 2.0 }
                    ]
                },
                {
                    id: "dragon", name: "Dragon Lore 1%", price: 200.00, color: "yellow-400",
                    img: findSkin("AWP", "Dragon Lore").img,
                    contents: [
                        { skin: findSkin("AWP", "Atheris"), chance: 80.0 },
                        { skin: findSkin("AWP", "Neo-Noir"), chance: 19.0 },
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 1.0 }
                    ]
                },
                {
                    id: "knife-budget", name: "Budget Knives", price: 150.00, color: "purple",
                    img: findSkin("Bayonet", "Slaughter").img,
                    contents: [
                        { skin: findSkin("Gut Knife", "Tiger Tooth"), chance: 70.0 },
                        { skin: findSkin("Flip Knife", "Tiger Tooth"), chance: 20.0 },
                        { skin: findSkin("Bayonet", "Tiger Tooth"), chance: 10.0 }
                    ]
                },
                {
                    id: "knife-ultra", name: "Ultra Knife Box", price: 500.00, color: "gold",
                    img: findSkin("Karambit", "Fade").img,
                    contents: [
                        { skin: findSkin("M9 Bayonet", "Doppler"), chance: 30.0 },
                        { skin: findSkin("Butterfly Knife", "Fade"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Tiger Tooth"), chance: 20.0 },
                        { skin: findSkin("Karambit", "Fade"), chance: 15.0 },
                        { skin: findSkin("Talon Knife", "Fade"), chance: 10.0 }
                    ]
                },
                {
                    id: "top-tier", name: "TOP TIER All Star", price: 300.00, color: "red",
                    img: findSkin("M4A4", "Howl").img,
                    contents: [
                        { skin: findSkin("M4A4", "Howl"), chance: 35.0 },
                        { skin: findSkin("AWP", "Medusa"), chance: 30.0 },
                        { skin: findSkin("AK-47", "Wild Lotus"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Doppler"), chance: 10.0 }
                    ]
                },
                {
                    id: "mystery", name: "Mystery Case", price: 75.00, color: "purple",
                    img: findSkin("Glock-18", "Water Elemental").img,
                    contents: [
                        { skin: findSkin("USP-S", "Orion"), chance: 40.0 },
                        { skin: findSkin("M4A1-S", "Hyper Beast"), chance: 30.0 },
                        { skin: findSkin("AK-47", "Neon Rider"), chance: 20.0 },
                        { skin: findSkin("Huntsman Knife", "Slaughter"), chance: 10.0 }
                    ]
                },
                {
                    id: "gloves", name: "Glove Heaven", price: 250.00, color: "pink",
                    img: findSkin("Sport Gloves", "Vice").img,
                    contents: [
                        { skin: findSkin("Moto Gloves", "Specter"), chance: 40.0 },
                        { skin: findSkin("Specialist Gloves", "Crimson Kimono"), chance: 35.0 },
                        { skin: findSkin("Hand Wraps", "Slaughter"), chance: 20.0 },
                        { skin: findSkin("Sport Gloves", "Pandoras Box"), chance: 5.0 }
                    ]
                },
                {
                    id: "legendary", name: "LEGENDARY Box", price: 1000.00, color: "gold",
                    img: findSkin("AWP", "Gungnir").img,
                    contents: [
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 20.0 },
                        { skin: findSkin("AWP", "Gungnir"), chance: 30.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Lore"), chance: 15.0 },
                        { skin: findSkin("M9 Bayonet", "Lore"), chance: 10.0 }
                    ]
                },
                {
                    id: "low-budget", name: "Low Roller", price: 2.50, color: "blue",
                    img: findSkin("P250", "Sand Dune").img,
                    contents: [
                        { skin: findSkin("Glock-18", "Catacombs"), chance: 50.0 },
                        { skin: findSkin("P250", "Sand Dune"), chance: 30.0 },
                        { skin: findSkin("USP-S", "Ticket to Hell"), chance: 15.0 },
                        { skin: findSkin("MAC-10", "Candy Apple"), chance: 5.0 }
                    ]
                },
                {
                    id: "mid-tier", name: "MID-TIER Master", price: 80.00, color: "purple",
                    img: findSkin("M4A4", "Desolate Space").img,
                    contents: [
                        { skin: findSkin("AK-47", "Redline"), chance: 35.0 },
                        { skin: findSkin("M4A4", "Desolate Space"), chance: 30.0 },
                        { skin: findSkin("AWP", "Containment Breach"), chance: 25.0 },
                        { skin: findSkin("Desert Eagle", "Printstream"), chance: 10.0 }
                    ]
                },
                {
                    id: "premium-gloves", name: "Premium Gloves", price: 350.00, color: "pink",
                    img: findSkin("Moto Gloves", "Eclipse").img,
                    contents: [
                        { skin: findSkin("Moto Gloves", "Eclipse"), chance: 40.0 },
                        { skin: findSkin("Driver Gloves", "Mogul"), chance: 30.0 },
                        { skin: findSkin("Sport Gloves", "Superconductor"), chance: 20.0 },
                        { skin: findSkin("Specialist Gloves", "Emerald Web"), chance: 10.0 }
                    ]
                },
                {
                    id: "ultra-premium", name: "Ultra Premium", price: 500.00, color: "red",
                    img: findSkin("AWP", "Dragon Lore").img,
                    contents: [
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 25.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Fade"), chance: 20.0 },
                        { skin: findSkin("Butterfly Knife", "Fade"), chance: 15.0 },
                        { skin: findSkin("Moto Gloves", "Blood Pressure"), chance: 15.0 }
                    ]
                },
                {
                    id: "knife-masters", name: "KNIFE Masters", price: 400.00, color: "yellow-400",
                    img: findSkin("Karambit", "Lore").img,
                    contents: [
                        { skin: findSkin("Karambit", "Lore"), chance: 30.0 },
                        { skin: findSkin("M9 Bayonet", "Lore"), chance: 25.0 },
                        { skin: findSkin("Butterfly Knife", "Crimson Web"), chance: 20.0 },
                        { skin: findSkin("Skeleton Knife", "Fade"), chance: 15.0 },
                        { skin: findSkin("Talon Knife", "Fade"), chance: 10.0 }
                    ]
                },
                {
                    id: "mega-pack", name: "MEGA PACK", price: 150.00, color: "red",
                    img: findSkin("M4A4", "Howl").img,
                    contents: [
                        { skin: findSkin("AWP", "Medusa"), chance: 20.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("AK-47", "Wild Lotus"), chance: 20.0 },
                        { skin: findSkin("Desert Eagle", "Emerald J√∂rmungandr"), chance: 15.0 },
                        { skin: findSkin("Karambit", "Tiger Tooth"), chance: 20.0 }
                    ]
                }
            );

            // CaseHug-inspired extra bedny (unik√°tn√≠, bez duplicit typu GAME ON 1/2/3/4)
            const extraCases = [
                { id:'neon-flora', name:'NEON FLORA', price:0.25, color:'blue', img:'https://cdn.casehug.com/cases/LUCKY_TEDDY_NEW.png?width=640&quality=85', top:[['AK-47','Ice Coaled'],['Glock-18','Neo-Noir']] },
                { id:'organic', name:'ORGANIC', price:0.30, color:'blue', img:'https://cdn.casehug.com/cases/ORGANIC.png?width=640&quality=85', top:[['USP-S','Cortex'],['AK-47','Slate']] },
                { id:'candy-drop', name:'CANDY DROP', price:0.40, color:'purple', img:'https://cdn.casehug.com/cases/candy_drop_1.png?width=640&quality=85', top:[['Glock-18','Bullet Queen'],['MAC-10','Neon Rider']] },
                { id:'double-cheese', name:'DOUBLE CHEESE', price:0.45, color:'blue', img:'https://cdn.casehug.com/cases/DOUBLE_CHEESE.png?width=640&quality=85', top:[['P250','Asiimov'],['USP-S','Ticket to Hell']] },
                { id:'ritual', name:'RITUAL', price:0.50, color:'purple', img:'https://cdn.casehug.com/cases/RITUAL.png?width=640&quality=85', top:[['M4A1-S','Night Terror'],['AWP','Mortis']] },
                { id:'hellfire', name:'HELLFIRE', price:0.70, color:'red', img:'https://cdn.casehug.com/cases/HELLFIRE_NEW.png?width=640&quality=85', top:[['M4A4','The Emperor'],['AK-47','Redline']] },
                { id:'frosty', name:'FROSTY', price:0.80, color:'blue', img:'https://cdn.casehug.com/cases/FROSTY.png?width=640&quality=85', top:[['AK-47','Ice Coaled'],['AK-47','Vulcan']] },
                { id:'sweet-tooth', name:'SWEET TOOTH', price:1.00, color:'purple', img:'https://cdn.casehug.com/content/case/regular/01/SWEET_TOOTH_1758194472.png?width=640&quality=85', top:[['Karambit','Tiger Tooth'],['Desert Eagle','Printstream']] },
                { id:'duck-luck', name:'DUCK LUCK', price:1.00, color:'blue', img:'https://cdn.casehug.com/cases/DUCK_LUCK.png?width=640&quality=85', top:[['AWP','Atheris'],['M4A4','Desolate Space']] },
                { id:'alien', name:'ALIEN', price:1.25, color:'purple', img:'https://cdn.casehug.com/cases/ALIEN.png?width=640&quality=85', top:[['USP-S','Neo-Noir'],['AWP','Neo-Noir']] },
                { id:'savanna', name:'SAVANNA', price:2.00, color:'blue', img:'https://cdn.casehug.com/cases/SAVANNA.png?width=640&quality=85', top:[['AK-47','Point Disarray'],['M4A1-S','Icarus Fell']] },
                { id:'wild-west', name:'WILD WEST', price:2.00, color:'purple', img:'https://cdn.casehug.com/cases/WILD_WEST.png?width=640&quality=85', top:[['Desert Eagle','Conspiracy'],['AK-47','Redline']] },
                { id:'insector', name:'INSECTOR', price:2.50, color:'blue', img:'https://cdn.casehug.com/cases/INSECTOR.png?width=640&quality=85', top:[['M4A4','Temukau'],['AWP','Oni Taiji']] },
                { id:'toxic', name:'TOXIC', price:2.60, color:'purple', img:'https://cdn.casehug.com/cases/TOXIC.png?width=640&quality=85', top:[['AK-47','Neon Rider'],['M4A1-S','Hyper Beast']] },
                { id:'workshop', name:'WORKSHOP', price:2.75, color:'blue', img:'https://cdn.casehug.com/cases/WORKSHOP.png?width=640&quality=85', top:[['M4A4','In Living Color'],['Glock-18','Water Elemental']] },
                { id:'game-on', name:'GAME ON', price:4.50, color:'purple', img:'https://cdn.casehug.com/cases/GAME_ON.png?width=640&quality=85', top:[['Glock-18','Gamma Doppler'],['M4A4','Temukau']] },
                { id:'bank-heist', name:'BANK HEIST', price:11.00, color:'red', img:'https://cdn.casehug.com/cases/BANK_HEIST.png?width=640&quality=85', top:[['Desert Eagle','Printstream'],['AWP','Asiimov']] },
                { id:'retro', name:'RETRO', price:11.50, color:'purple', img:'https://cdn.casehug.com/cases/RETRO.png?width=640&quality=85', top:[['USP-S','Printstream'],['AK-47','Bloodsport']] },
                { id:'bunny-hop', name:'BUNNY HOP', price:12.75, color:'purple', img:'https://cdn.casehug.com/cases/BUNNY_HOP.png?width=640&quality=85', top:[['Skeleton Knife','Crimson Web'],['M4A1-S','Printstream']] },
                { id:'titan', name:'TITAN', price:14.50, color:'red', img:'https://cdn.casehug.com/cases/TITAN.png?width=640&quality=85', top:[['M9 Bayonet','Doppler'],['AK-47','Vulcan']] },
                { id:'gambit', name:'GAMBIT', price:18.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GAMBIT.png?width=640&quality=85', top:[['Skeleton Knife','Tiger Tooth'],['Butterfly Knife','Tiger Tooth']] },
                { id:'savage', name:'SAVAGE', price:25.00, color:'red', img:'https://cdn.casehug.com/cases/SAVAGE.png?width=640&quality=85', top:[['AK-47','Gold Arabesque'],['AWP','Containment Breach']] },
                { id:'golderra', name:'GOLDERRA', price:26.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GOLDERRA.png?width=640&quality=85', top:[['M9 Bayonet','Lore'],['Karambit','Lore']] },
                { id:'ferro', name:'FERRO', price:30.00, color:'red', img:'https://cdn.casehug.com/cases/FERRO.png?width=640&quality=85', top:[['Desert Eagle','Blaze'],['M4A1-S','Blue Phosphor']] },
                { id:'plant-b', name:'PLANT B', price:36.00, color:'red', img:'https://cdn.casehug.com/cases/bombsite_b_1.png?width=640&quality=85', top:[['AWP','Dragon Lore'],['AK-47','Bloodsport']] },
                { id:'buzzer-blade', name:'BUZZER BLADE', price:42.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/BUZZER_BLADE.png?width=640&quality=85', top:[['Talon Knife','Fade'],['Karambit','Doppler']] },
                { id:'candy-shop', name:'CANDY SHOP', price:45.00, color:'red', img:'https://cdn.casehug.com/cases/CANDY_SHOP.png?width=640&quality=85', top:[['AK-47','Neon Rider'],['M4A1-S','Player Two']] },
                { id:'kingdom', name:'KINGDOM', price:46.50, color:'red', img:'https://cdn.casehug.com/cases/kingdom_1.png?width=640&quality=85', top:[['AWP','Medusa'],['Karambit','Fade']] },
                { id:'sushi-master', name:'SUSHI MASTER', price:50.00, color:'red', img:'https://cdn.casehug.com/content/case/regular/01/SUSHI_MASTER_1758194472.png?width=640&quality=85', top:[['M4A4','Howl'],['AK-47','Wild Lotus']] },
                { id:'warzone', name:'WARZONE', price:75.00, color:'red', img:'https://cdn.casehug.com/cases/WARZONE.png?width=640&quality=85', top:[['AWP','Gungnir'],['M4A4','Howl']] },
                { id:'circus', name:'CIRCUS', price:80.00, color:'red', img:'https://cdn.casehug.com/cases/CIRCUS.png?width=640&quality=85', top:[['Butterfly Knife','Fade'],['Karambit','Marble Fade']] },
                { id:'vac-attack', name:'VAC ATTACK', price:85.00, color:'red', img:'https://cdn.casehug.com/cases/VAC_ATTACK.png?width=640&quality=85', top:[['AWP','Dragon Lore'],['Sport Gloves',"Pandora's Box"]] },
                { id:'chinatown', name:'CHINATOWN', price:97.50, color:'red', img:'https://cdn.casehug.com/cases/CHINATOWN.png?width=640&quality=85', top:[['AK-47','Wild Lotus'],['M4A1-S','Welcome to the Jungle']] },
                { id:'el-dorado', name:'EL DORADO', price:100.00, color:'yellow-400', img:'https://cdn.casehug.com/content/case/regular/01/EL_DORADO_1758194472.png?width=640&quality=85', top:[['AK-47','Gold Arabesque'],['Desert Eagle','Blaze']] },
                { id:'arcana', name:'ARCANA', price:120.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/ARCANA.png?width=640&quality=85', top:[['Karambit','Lore'],['Sport Gloves','Vice']] },
                { id:'babushka', name:'BABUSHKA', price:152.50, color:'red', img:'https://cdn.casehug.com/cases/BABUSHKA.png?width=640&quality=85', top:[['M9 Bayonet','Autotronic'],['M4A1-S','Printstream']] },
                { id:'quantum', name:'QUANTUM', price:358.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/QUANTUM.png?width=640&quality=85', top:[['AWP','Gungnir'],['Karambit','Fade']] },
                { id:'tiger', name:'TIGER', price:3.80, color:'purple', img:'https://cdn.casehug.com/cases/TIGER.png?width=640&quality=85', top:[['M9 Bayonet','Tiger Tooth'],['Karambit','Tiger Tooth']] },
                { id:'demolition', name:'DEMOLITION', price:11.00, color:'red', img:'https://cdn.casehug.com/cases/DEMOLITION.png?width=640&quality=85', top:[['AWP','Asiimov'],['M4A4','The Emperor']] },
                { id:'electronic', name:'ELECTRONIC', price:33.00, color:'purple', img:'https://cdn.casehug.com/cases/ELECTRONIC.png?width=640&quality=85', top:[['M4A4','Howl'],['AK-47','Bloodsport']] },
                { id:'lab', name:'LAB', price:150.00, color:'red', img:'https://cdn.casehug.com/cases/LAB.png?width=640&quality=85', top:[['AWP','Gungnir'],['M4A1-S','Blue Phosphor']] },
                { id:'howl-case', name:'HOWL', price:300.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/HOWL_4.png?width=640&quality=85', top:[['M4A4','Howl'],['AK-47','Wild Lotus']] }
            ];

            const chanceProfiles = [
                [30, 25, 18, 14, 9, 4],
                [22, 24, 21, 16, 12, 5],
                [12, 20, 24, 22, 16, 6],
                [6, 14, 24, 24, 22, 10],
                [2.5, 7.5, 18, 27, 28, 17],
                [0.8, 3.2, 10, 22, 31, 33],
                [0.1, 1.9, 8, 20, 30, 40]
            ];

            const allSkins = Object.values(skinsDB);
            const pickRange = (minPrice, maxPrice, exclude = []) => {
                const pool = allSkins.filter(s => s.price >= minPrice && s.price <= maxPrice && !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[Math.floor(Math.random() * pool.length)];
            };
            const pickAny = (exclude = []) => {
                const pool = allSkins.filter(s => !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[Math.floor(Math.random() * pool.length)];
            };

            const hash = (str) => str.split('').reduce((a, ch) => ((a * 31) + ch.charCodeAt(0)) % 9973, 7);
            const normalizeProfile = (arr) => {
                const sum = arr.reduce((a,b)=>a+b,0);
                const scaled = arr.map(v => (v / sum) * 100);
                const rounded = scaled.map(v => Math.round(v * 10) / 10);
                const diff = Math.round((100 - rounded.reduce((a,b)=>a+b,0)) * 10) / 10;
                rounded[rounded.length - 1] = Math.round((rounded[rounded.length - 1] + diff) * 10) / 10;
                return rounded;
            };

            const chooseChancePattern = (caseObj, jackpotPrice) => {
                const ratio = jackpotPrice / Math.max(0.01, caseObj.price);
                let tier = 0;
                if(ratio >= 120) tier = 6;
                else if(ratio >= 50) tier = 5;
                else if(ratio >= 20) tier = 4;
                else if(ratio >= 10) tier = 3;
                else if(ratio >= 5) tier = 2;
                else if(ratio >= 2) tier = 1;
                const variability = hash(caseObj.id + caseObj.name) % 3;
                const idx = Math.max(0, Math.min(chanceProfiles.length - 1, tier - (variability === 0 ? 0 : (variability === 1 ? 1 : -1))));
                return normalizeProfile([...chanceProfiles[idx]]);
            };

            extraCases.forEach(ec => {
                if(casesDB.find(c => c.id === ec.id)) return;

                const price = ec.price;
                const top1 = findSkin(ec.top[0][0], ec.top[0][1]);
                const top2 = findSkin(ec.top[1][0], ec.top[1][1]);
                const picks = [];
                const used = [];

                const low1 = pickRange(0.01, Math.max(0.05, price * 0.20), used) || pickAny(used);
                if(low1) { picks.push(low1); used.push(low1); }

                const low2 = pickRange(Math.max(0.02, price * 0.15), Math.max(0.15, price * 0.45), used) || pickAny(used);
                if(low2) { picks.push(low2); used.push(low2); }

                const mid = pickRange(Math.max(0.05, price * 0.40), Math.max(0.3, price * 0.95), used) || pickAny(used);
                if(mid) { picks.push(mid); used.push(mid); }

                const hi = top2 && !used.find(x => x.id === top2.id)
                    ? top2
                    : (pickRange(Math.max(0.2, price * 0.9), Math.max(1, price * 1.8), used) || pickAny(used));
                if(hi) { picks.push(hi); used.push(hi); }

                const superHi = pickRange(Math.max(0.5, price * 1.3), Math.max(2, price * 3.0), used) || pickAny(used);
                if(superHi) { picks.push(superHi); used.push(superHi); }

                const jackpot = top1 && !used.find(x => x.id === top1.id)
                    ? top1
                    : (pickRange(Math.max(1, price * 2.0), Math.max(5, price * 20), used) || pickAny(used));
                if(jackpot) { picks.push(jackpot); used.push(jackpot); }

                while(picks.length < 6) {
                    const extra = pickAny(used);
                    if(!extra) break;
                    picks.push(extra);
                    used.push(extra);
                }

                const sortedByPrice = picks.slice(0, 6).sort((a, b) => b.price - a.price);
                const chances = chooseChancePattern(ec, sortedByPrice[0]?.price || price);

                casesDB.push({
                    id: ec.id,
                    name: ec.name,
                    price: ec.price,
                    color: ec.color,
                    img: ec.img,
                    contents: sortedByPrice.map((skin, idx) => ({ skin, chance: chances[idx] || 0.1 }))
                });
            });

            renderCases();
        }, 100);

        let userInventory = [];
        let activeCaseId = null;
        let isSpinning = false;
        let spinAnimationId = null;
        let casesAffordableOnly = false;
        let userProfile = {
            nickname: '',
            displayName: '',
            avatar: '',
            provider: 'Guest'
        };

        // --- Z√ÅKLADY UI ---
        function formatMoney(val) { return `${val.toLocaleString('cs-CZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} EUR`; }
        const CURRENCY_RATES = { EUR: 1, USD: 1.08, CZK: 25.5 };
        function updateUI() {
            const sel = document.getElementById('currency-select');
            const cur = sel ? sel.value : 'EUR';
            const rate = CURRENCY_RATES[cur] || 1;
            const converted = balanceBase * rate;
            const decimals = cur === 'CZK' ? 0 : 2;
            const formatted = converted.toLocaleString(cur === 'CZK' ? 'cs-CZ' : 'en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
            document.getElementById('balance').textContent = `${formatted} ${cur}`;
            const lbl = document.getElementById('balance-currency-label');
            if(lbl) lbl.textContent = `Z≈Østatek (${cur})`;
            const authLabel = document.getElementById('auth-open-label');
            const pill = document.getElementById('profile-pill');
            const pillName = document.getElementById('profile-pill-name');
            const pillNick = document.getElementById('profile-pill-nick');
            const pillAvatar = document.getElementById('profile-pill-avatar');
            if(authLabel) authLabel.textContent = userProfile.nickname ? 'Profil' : 'P≈ôihl√°sit';
            if(pill && pillName && pillNick && pillAvatar) {
                if(userProfile.nickname) {
                    pill.classList.remove('hidden');
                    pill.classList.add('flex');
                    pillName.textContent = userProfile.displayName || userProfile.nickname;
                    pillNick.textContent = `@${userProfile.nickname} ‚Ä¢ ${userProfile.provider || 'User'}`;
                    pillAvatar.src = userProfile.avatar || FALLBACK_IMG;
                } else {
                    pill.classList.add('hidden');
                    pill.classList.remove('flex');
                }
            }
            lucide.createIcons();
        }

        function openAuthModal() {
            const modal = document.getElementById('auth-modal');
            if(!modal) return;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('profile-nickname').value = userProfile.nickname || '';
            document.getElementById('profile-display-name').value = userProfile.displayName || '';
            document.getElementById('profile-avatar').value = userProfile.avatar || '';
            lucide.createIcons();
        }

        function closeAuthModal() {
            const modal = document.getElementById('auth-modal');
            if(!modal) return;
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function saveLocalProfile() {
            const nickname = (document.getElementById('profile-nickname')?.value || '').trim();
            if(!nickname) return showToast('Vypl≈à nickname.', true);
            userProfile = {
                nickname,
                displayName: (document.getElementById('profile-display-name')?.value || nickname).trim(),
                avatar: (document.getElementById('profile-avatar')?.value || '').trim(),
                provider: 'Local Demo'
            };
            localStorage.setItem('otodropProfile', JSON.stringify(userProfile));
            updateUI();
            closeAuthModal();
            showToast('Profil ulo≈æen ‚úÖ');
        }

        function logoutLocalProfile() {
            userProfile = { nickname: '', displayName: '', avatar: '', provider: 'Guest' };
            localStorage.removeItem('otodropProfile');
            updateUI();
            showToast('Odhl√°≈°eno');
        }

        const DAILY_REWARD_COOLDOWN = 6 * 60 * 60 * 1000;
        function claimDailyReward() {
            const now = Date.now();
            const last = parseInt(localStorage.getItem('lastDailyReward') || '0', 10);
            const diff = now - last;
            if(diff < DAILY_REWARD_COOLDOWN) {
                const sec = Math.ceil((DAILY_REWARD_COOLDOWN - diff) / 1000);
                const h = Math.floor(sec / 3600);
                const m = Math.floor((sec % 3600) / 60);
                return showToast(`Dal≈°√≠ odmƒõna za ${h}h ${m}m`, true);
            }
            const reward = Math.floor(200 + Math.random() * 600);
            balanceBase += reward;
            localStorage.setItem('lastDailyReward', String(now));
            updateUI();
            showToast(`Daily odmƒõna: +${reward} EUR üî•`);
        }

        function toggleAffordableCases() {
            casesAffordableOnly = !casesAffordableOnly;
            const btn = document.getElementById('cases-affordable-btn');
            if(btn) {
                btn.textContent = casesAffordableOnly ? 'Dostupn√©: ON' : 'Jen dostupn√©';
                btn.classList.toggle('bg-green-500/20', casesAffordableOnly);
                btn.classList.toggle('text-green-300', casesAffordableOnly);
            }
            renderCases();
        }

        function showToast(text, isError = false) {
            const t = document.getElementById('toast');
            t.textContent = text;
            t.style.backgroundColor = isError ? '#ef4444' : '#facc15';
            t.style.color = isError ? 'white' : 'black';
            t.style.borderColor = isError ? '#dc2626' : '#fde047';
            t.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-10'), 3000);
        }

        function switchPage(id) {
            if(isSpinning) return;
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            const page = document.getElementById(`page-${id}`);
            if (page) page.classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeNav = Array.from(document.querySelectorAll('.nav-link')).find(l => l.getAttribute('onclick').includes(`'${id}'`));
            if(activeNav) activeNav.classList.add('active');

            if(id === 'inventory') renderInventory();
            if(id === 'upgrade') renderUpgrader();
            activeCaseId = null; 
        }

        function addFreeMoney() {
            balanceBase += 1000;
            updateUI();
            showToast("P≈ôid√°no 1000 EUR!");
            initAudio(); // Pro sichr init z tlaƒç√≠tka
        }

        // --- FULL-SCREEN V√ùHERN√ç POPUP A EFEKTY ---
        function createParticles(color) {
            const container = document.getElementById('particles-container');
            container.innerHTML = ''; // Vyƒçistit star√©
            for(let i=0; i<60; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.backgroundColor = color;
                const size = Math.random() * 8 + 4;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.left = '50%';
                p.style.top = '50%';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 400 + 100;
                p.style.setProperty('--tx', `${Math.cos(angle) * velocity}px`);
                p.style.setProperty('--ty', `${Math.sin(angle) * velocity}px`);
                
                container.appendChild(p);
            }
        }

        function showWinModal(skin) {
            const modal = document.getElementById('win-modal');
            const img = document.getElementById('win-image');
            
            document.getElementById('win-name').textContent = skin.name;
            document.getElementById('win-price').textContent = formatMoney(skin.price);
            document.getElementById('win-sell-price').textContent = formatMoney(skin.price);
            document.getElementById('win-bg-glow').style.backgroundColor = skin.color;
            
            img.src = skin.img;
            
            modal.classList.remove('hidden');
            // Mal√Ω delay pro CSS tranzici
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                img.classList.add('win-pop');
                
                // Efekty pokud je to red/gold
                if(skin.color === '#eb4b4b' || skin.color === '#ebca44') {
                    createParticles(skin.color);
                }
                
                SoundEngine.playWin(skin.rarityName);
            }, 50);

            // Nastaven√≠ tlaƒç√≠tek
            document.getElementById('btn-win-sell').onclick = () => {
                balanceBase += skin.price;
                updateUI();
                showToast(`Z√≠sk√°no ${formatMoney(skin.price)}`);
                closeWinModal();
            };
            
            document.getElementById('btn-win-keep').onclick = () => {
                addToInventory(skin);
                showToast(`Ulo≈æeno do invent√°≈ôe`);
                closeWinModal();
            };
        }

        function closeWinModal() {
            const modal = document.getElementById('win-modal');
            modal.classList.add('opacity-0');
            document.getElementById('win-image').classList.remove('win-pop');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        // --- BEDNY ---
        function renderCases() {
            const grid = document.getElementById('cases-grid');
            if(!grid) return;
            const sortSel = document.getElementById('cases-sort');
            const sortMode = sortSel ? sortSel.value : 'default';
            const groups = [
                { key: 'budget', title: 'üíô BUDGET CASEKY', min: 0, max: 4.99 },
                { key: 'standard', title: 'üíú STANDARD CASEKY', min: 5, max: 24.99 },
                { key: 'premium', title: '‚ù§Ô∏è PREMIUM CASEKY', min: 25, max: 99.99 },
                { key: 'legendary', title: 'üíõ LEGENDARY CASEKY', min: 100, max: Infinity }
            ];

            const sortCases = (arr) => {
                if(sortMode === 'price-asc') return arr.sort((a,b)=>a.price-b.price);
                if(sortMode === 'price-desc') return arr.sort((a,b)=>b.price-a.price);
                if(sortMode === 'name') return arr.sort((a,b)=>a.name.localeCompare(b.name));
                return arr;
            };

            const renderCard = (c, idx) => {
                let glowClass = '';
                if(c.color === 'blue') glowClass = 'glow-blue';
                else if(c.color === 'red') glowClass = 'glow-red';
                else if(c.color === 'purple') glowClass = 'glow-purple';
                else if(c.color === 'pink') glowClass = 'glow-pink';
                else if(c.color === 'yellow-400') glowClass = 'glow-gold';

                const affordable = balanceBase >= c.price;
                return `
<div onclick="openCaseView('${c.id}')" class="bg-[#14171c] p-6 rounded-3xl border-2 ${affordable ? 'border-yellow-400/25 hover:border-yellow-400' : 'border-gray-700/70 hover:border-gray-500'} cursor-pointer transition-all group text-center shadow-lg relative overflow-hidden item-float ${glowClass}" style="animation-delay: ${idx * 60}ms;">
    <div class="absolute inset-0 ${affordable ? 'bg-yellow-400/5 group-hover:opacity-100' : 'bg-gray-600/5 group-hover:opacity-70'} opacity-0 transition-opacity"></div>
    <img src="${c.img}" onerror="handleImgError(this)" class="w-full h-32 object-contain group-hover:scale-110 transition-transform relative z-10 drop-shadow-xl mb-4">
    <div class="font-black text-sm uppercase text-gray-300 relative z-10">${c.name}</div>
    <div class="text-yellow-400 font-bold mt-1 relative z-10">${formatMoney(c.price)}</div>
</div>
`;
            };

            grid.innerHTML = groups.map(g => {
                let items = casesDB.filter(c => c.price >= g.min && c.price <= g.max);
                if(casesAffordableOnly) items = items.filter(c => balanceBase >= c.price);
                items = sortCases(items.slice());
                if(items.length === 0) return '';
                return `
                    <section>
                        <h3 class="text-lg font-black uppercase tracking-widest text-yellow-300 mb-4 border-b border-yellow-400/20 pb-2">${g.title}</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                            ${items.map((c, idx) => renderCard(c, idx)).join('')}
                        </div>
                    </section>
                `;
            }).join('') || '<div class="text-center py-12 text-gray-500 font-black uppercase">≈Ω√°dn√© bedny pro tento filtr.</div>';
        }

        // Vlo≈æ pod funkci renderCases (kolem ≈ô√°dku 815)
        document.addEventListener('click', (e) => {
            // Najde nejbli≈æ≈°√≠ rodiƒçovsk√Ω element, kter√Ω m√° ID bedny
            const caseCard = e.target.closest('[onclick^="openCaseView"]');
            if (caseCard && !isSpinning) {
                // Z√≠sk√° ID bedny z onclick atributu
                const match = caseCard.getAttribute('onclick').match(/'([^']+)'/);
                if (match) {
                    openCaseView(match[1]);
                }
            }
        });

        function rollCaseSkin(caseObj) {
            const roll = Math.random() * 100;
            let sum = 0;
            let win = caseObj.contents[0].skin;
            for(const item of caseObj.contents) {
                sum += item.chance;
                if(roll <= sum) { win = item.skin; break; }
            }
            return win;
        }

        function renderMultiResultCard(skin) {
            return `<div class="bg-[#14171c] border-b-4 rounded-xl p-2 text-center" style="border-color:${skin.color}"><img src="${skin.img}" onerror="handleImgError(this)" class="h-16 w-full object-contain mb-1"><div class="text-[9px] font-black uppercase truncate">${skin.name}</div><div class="text-[10px] text-yellow-300 font-bold">${formatMoney(skin.price)}</div></div>`;
        }

        function getOpenCount() {
            const countSel = document.getElementById('open-count');
            return Math.max(1, Math.min(5, parseInt(countSel?.value || '1', 10)));
        }

        function fillTrackWithCaseSkins(track, caseObj, winningSkin = null) {
            const totalItems = 60;
            const winningIndex = 50;
            let html = '';
            for(let j=0;j<totalItems;j++) {
                const skin = (winningSkin && j === winningIndex)
                    ? winningSkin
                    : caseObj.contents[Math.floor(Math.random()*caseObj.contents.length)].skin;
                html += `<div class="spinner-item" style="border-color:${skin.color}"><img src="${skin.img}" data-alts="${(skin.imgAlts||[]).join('|')}" onerror="handleImgError(this)"><div class="text-[10px] font-black uppercase text-gray-300 mt-2 truncate w-full text-center">${skin.name}</div></div>`;
            }
            track.innerHTML = html;
        }

        function ensureSpinnerRows(count, caseObj = null) {
            const stack = document.getElementById('spinner-stack');
            if(!stack) return [];
            if(stack.children.length !== count) {
                stack.innerHTML = Array.from({ length: count }, (_, i) => `
                    <div class="spinner-container relative" data-spin-row="${i}">
                        <div class="blur-edges blur-left"></div>
                        <div class="blur-edges blur-right"></div>
                        <div class="spinner-selector"></div>
                        <div id="spinner-track-${i}" class="spinner-track"></div>
                    </div>
                `).join('');
            }
            const tracks = Array.from(stack.querySelectorAll('.spinner-track'));
            tracks.forEach(track => {
                track.style.transition = 'none';
                track.style.transform = 'translateX(0px)';
                if(caseObj) fillTrackWithCaseSkins(track, caseObj);
            });
            return tracks;
        }

        function spinCase(caseObj, count = 1) {
            if(isSpinning) return;
            const totalCost = caseObj.price * count;
            if(balanceBase < totalCost) return showToast(`Nem√°≈° dostatek penƒõz (${formatMoney(totalCost)})`, true);

            balanceBase -= totalCost;
            updateUI();
            isSpinning = true;

            const btn = document.getElementById('btn-open-case');
            const countSel = document.getElementById('open-count');
            const results = document.getElementById('spin-results');
            if(results) results.innerHTML = '';

            if(btn) {
                btn.disabled = true;
                btn.classList.add('opacity-50');
                btn.textContent = count > 1 ? `Toƒç√≠ se ${count}x...` : 'Toƒç√≠ se...';
            }
            if(countSel) countSel.disabled = true;

            const tracks = ensureSpinnerRows(count);
            const rowMeta = [];
            const winningIndex = 50;
            const itemWidth = 148;

            for(let i = 0; i < count; i++) {
                const winningSkin = rollCaseSkin(caseObj);
                const track = tracks[i];
                if(!track) continue;
                fillTrackWithCaseSkins(track, caseObj, winningSkin);
                rowMeta.push({ track, row: track.parentElement, winningSkin });
            }

            setTimeout(() => {
                rowMeta.forEach((m) => {
                    const containerWidth = m.row.clientWidth;
                    const finalOffset = (winningIndex * itemWidth) + (itemWidth / 2) - (containerWidth / 2);
                    m.track.style.transition = 'transform 6s cubic-bezier(0.1, 0, 0.1, 1)';
                    m.track.style.transform = `translateX(-${finalOffset}px)`;
                });

                setTimeout(() => {
                    let totalWin = 0;
                    rowMeta.forEach(m => {
                        addToInventory(m.winningSkin);
                        totalWin += m.winningSkin.price;
                        if(results) results.insertAdjacentHTML('beforeend', renderMultiResultCard(m.winningSkin));
                    });

                    if(count === 1 && rowMeta[0]) {
                        showWinModal(rowMeta[0].winningSkin);
                    } else {
                        showToast(`Hotovo: ${count} skin≈Ø (${formatMoney(totalWin)})`);
                    }

                    isSpinning = false;
                    if(btn) {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50');
                        btn.textContent = 'HR√ÅT ZNOVU';
                    }
                    if(countSel) countSel.disabled = false;
                }, 6500);
            }, 50);
        }

        function openCaseView(id) {
            activeCaseId = id;
            const c = casesDB.find(x => x.id === id);
            if(!c) { showToast('Bedna nebyla nalezena', true); return; }
            
            document.getElementById('view-case-name').textContent = c.name;
            document.getElementById('view-case-price').textContent = `${formatMoney(c.price)}`;
            document.getElementById('view-case-name').style.color = getComputedStyle(document.documentElement).getPropertyValue(`--rarity-${c.color === 'yellow-400' ? 'gold' : c.color}`);

            const changer = document.getElementById('case-changer');
            if(changer) {
                changer.innerHTML = '<option value="">üéÅ Zmƒõnit bednu</option>';
                casesDB.forEach(caseItem => {
                    const opt = document.createElement('option');
                    opt.value = caseItem.id;
                    opt.textContent = `${caseItem.name} - ${formatMoney(caseItem.price)}`;
                    opt.selected = caseItem.id === id;
                    changer.appendChild(opt);
                });
            }

            const countSel = document.getElementById('open-count');
            const selectedCount = () => getOpenCount();
            ensureSpinnerRows(selectedCount(), c);
            const results = document.getElementById('spin-results');
            if(results) results.innerHTML = '';
            
            document.getElementById('view-case-contents').innerHTML = c.contents.map(item => `
                <div class="bg-gray-900/50 p-3 rounded-xl border-b-2 flex flex-col items-center text-center" style="border-color: ${item.skin.color}">
                    <img src="${item.skin.img}" data-alts="${(item.skin.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-16 object-contain mb-2 drop-shadow-md">
                    <div class="text-[9px] font-bold text-gray-400 uppercase truncate w-full">${item.skin.name}</div>
                    <div class="text-[10px] font-black text-white">${item.chance}%</div>
                </div>
            `).join('');

            const btn = document.getElementById('btn-open-case');
            btn.onclick = () => spinCase(c, selectedCount());
            if(countSel) {
                countSel.onchange = () => {
                    ensureSpinnerRows(selectedCount(), c);
                    if(results) results.innerHTML = '';
                };
                countSel.disabled = false;
            }
            btn.textContent = "OTEV≈ò√çT BEDNU";
            btn.disabled = false;
            btn.classList.remove('opacity-50');

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-case-view').classList.remove('hidden');
        }

        function startSpinner(caseObj) { spinCase(caseObj, 1); }

        // --- INVENT√Å≈ò ---
        function addToInventory(skin) {
            userInventory.unshift({ ...skin, uid: Date.now() + Math.random().toString(36).substring(7) });
            updateUI();
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            const stats = document.getElementById('inv-stats');
            if(!grid) return;

            if(userInventory.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-20 font-bold uppercase">Invent√°≈ô je pr√°zdn√Ω.</div>`;
                stats.textContent = `0 p≈ôedmƒõt≈Ø v hodnotƒõ 0.00 EUR`;
                return;
            }

            let displayItems = userInventory;
            
            // Aplikuj filtr
            const filterVal = document.getElementById('inv-filter')?.value || 'all';
            if(filterVal === 'blue') displayItems = displayItems.filter(i => i.color === '#4b69ff');
            else if(filterVal === 'purple') displayItems = displayItems.filter(i => i.color === '#8847ff');
            else if(filterVal === 'pink') displayItems = displayItems.filter(i => i.color === '#d32ee6');
            else if(filterVal === 'red') displayItems = displayItems.filter(i => i.color === '#eb4b4b');
            else if(filterVal === 'gold') displayItems = displayItems.filter(i => i.color === '#ebca44');
            else if(filterVal === 'knives') displayItems = displayItems.filter(i => KNIFE_TYPES.some(k => i.weapon === k));

            // Aplikuj t≈ô√≠dƒõn√≠
            const sortVal = document.getElementById('inv-sort')?.value || 'newest';
            if(sortVal === 'price-high') displayItems.sort((a, b) => b.price - a.price);
            else if(sortVal === 'price-low') displayItems.sort((a, b) => a.price - b.price);
            else if(sortVal === 'name') displayItems.sort((a, b) => a.name.localeCompare(b.name));

            let totalVal = 0;
            grid.innerHTML = displayItems.map((item, idx) => {
                totalVal += item.price;
                return `
                <div class="bg-[#14171c] p-4 rounded-2xl border-b-4 group relative overflow-hidden transition-all hover:scale-105 shadow-lg item-float" style="border-color: ${item.color}; animation-delay: ${idx * 50}ms;">
                    <div class="absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity" style="background-color: ${item.color}"></div>
                    <img src="${item.img}" data-alts="${(item.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="w-full h-24 object-contain drop-shadow-xl group-hover:scale-110 transition-transform">
                    <div class="mt-3 text-center">
                        <div class="text-[10px] font-black uppercase text-gray-400 truncate">${item.name}</div>
                        <div class="text-sm font-black text-white mt-1">${formatMoney(item.price)}</div>
                    </div>
                    <button onclick="sellSkin('${item.uid}')" class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 bg-red-500/80 hover:bg-red-500 text-white p-2 rounded-lg transition-all shadow-lg backdrop-blur-sm">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>`;
            }).join('');
            
            stats.textContent = `${displayItems.length} p≈ôedmƒõt≈Ø v hodnotƒõ ${formatMoney(totalVal)}`;
            lucide.createIcons();
        }

        function filterInventory() {
            renderInventory();
        }

        function sortInventory() {
            renderInventory();
        }

        function sellSkin(uid) {
            const idx = userInventory.findIndex(i => i.uid === uid);
            if(idx > -1) {
                balanceBase += userInventory[idx].price;
                userInventory.splice(idx, 1);
                updateUI(); renderInventory();
                for(let i=0; i<3; i++) { if(upgInputs[i] && upgInputs[i].uid === uid) upgInputs[i] = null; }
            }
        }

        function sellAllSkins() {
            if(userInventory.length === 0) return;
            balanceBase += userInventory.reduce((acc, curr) => acc + curr.price, 0);
            userInventory = [];
            updateUI(); renderInventory();
            upgInputs = [null, null, null]; upgTarget = null;
        }

        // --- UPGRADER ---
        let upgInputs = [null, null, null];
        let upgTarget = null;

        function renderUpgrader() {
            const container = document.getElementById('upg-inputs-container');
            let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
            
            container.innerHTML = [0,1,2].map(i => upgInputs[i] ? `
                <div onclick="removeUpgInput(${i})" class="bg-gray-800/80 border border-gray-600 hover:border-red-500 rounded-2xl h-24 flex items-center p-3 cursor-pointer group relative overflow-hidden transition-all">
                    <img src="${upgInputs[i].img}" data-alts="${(upgInputs[i].imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-16 w-20 object-contain drop-shadow-md">
                    <div class="ml-3 flex-1 overflow-hidden">
                        <div class="text-[10px] font-bold text-gray-400 uppercase truncate">${upgInputs[i].name}</div>
                        <div class="text-sm font-black text-white">${formatMoney(upgInputs[i].price)}</div>
                    </div>
                    <div class="absolute inset-0 bg-red-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity backdrop-blur-[2px]">
                        <i data-lucide="trash-2" class="w-6 h-6 text-red-500"></i>
                    </div>
                </div>
            ` : `
                <div onclick="openSelector('input', ${i})" class="bg-gray-900/50 border-2 border-dashed border-gray-600 hover:border-purple-500 rounded-2xl h-24 flex items-center justify-center cursor-pointer transition-all group">
                    <i data-lucide="plus" class="w-6 h-6 text-gray-600 group-hover:text-purple-500 transition-colors"></i>
                </div>
            `).join('');
            
            document.getElementById('upg-total-input-val').textContent = formatMoney(totalVal);

            if(upgTarget && upgTarget.price <= totalVal) upgTarget = null;

            const targetSlot = document.getElementById('upg-target-slot');
            let chance = 0;

            if(upgTarget) {
                targetSlot.classList.remove('border-dashed', 'border-purple-500/50');
                targetSlot.style.borderColor = upgTarget.color;
                targetSlot.innerHTML = `
                    <div class="absolute inset-0 opacity-20" style="background: linear-gradient(to top, ${upgTarget.color}, transparent);"></div>
                    <img src="${upgTarget.img}" data-alts="${(upgTarget.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-32 object-contain drop-shadow-[0_0_20px_rgba(255,255,255,0.2)] mb-2 relative z-10 group-hover:scale-110 transition-transform">
                    <div class="text-xs font-black text-white uppercase text-center relative z-10 w-full truncate px-2" style="color: ${upgTarget.color}">${upgTarget.name}</div>
                    <div class="text-lg font-black text-white relative z-10">${formatMoney(upgTarget.price)}</div>
                `;
                chance = Math.min((totalVal / upgTarget.price) * 100, 90);
            } else {
                targetSlot.removeAttribute('style');
                targetSlot.classList.add('border-dashed', 'border-purple-500/50');
                targetSlot.innerHTML = `<i data-lucide="search" class="w-10 h-10 text-purple-500/50 group-hover:text-yellow-400 mb-2"></i><span class="text-gray-500 font-bold uppercase text-xs text-center group-hover:text-white">Vyber c√≠l</span>`;
            }

            document.getElementById('upgrade-chance').textContent = chance.toFixed(1) + '%';
            document.getElementById('upgrade-circle').style.strokeDashoffset = 540 - (540 * (chance / 100));
            lucide.createIcons();
        }

        function removeUpgInput(i) { upgInputs[i] = null; renderUpgrader(); }

        function openSelector(type, slotIndex = 0) {
            window.currentSelectorType = type;
            window.currentSelectorSlot = slotIndex;
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-selector').classList.remove('hidden');
            
            const grid = document.getElementById('selector-grid');
            if (type === 'input') {
                document.getElementById('selector-title').textContent = "VYBER SKIN K OBƒöTOV√ÅN√ç";
                let available = userInventory.filter(item => !upgInputs.some(ui => ui && ui.uid === item.uid));
                const sortMode = document.getElementById('selector-sort')?.value || 'price-low';
                if(sortMode === 'price-high') available.sort((a,b)=>b.price-a.price);
                else if(sortMode === 'name') available.sort((a,b)=>a.name.localeCompare(b.name));
                else available.sort((a,b)=>a.price-b.price);
                grid.innerHTML = available.map((item, idx) => `
                    <div onclick="upgInputs[${slotIndex}] = userInventory.find(i=>i.uid==='${item.uid}'); switchPage('upgrade');" class="bg-[#1a1e26] p-4 rounded-xl cursor-pointer hover:bg-gray-800 transition-all border-b-4 item-float" style="border-color: ${item.color}; animation-delay: ${idx * 50}ms;">
                        <img src="${item.img}" data-alts="${(item.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-20 w-full object-contain mb-3 drop-shadow-md hover:scale-110 transition-transform">
                        <div class="text-[10px] text-center truncate font-bold text-gray-400 uppercase">${item.name}</div>
                        <div class="text-sm text-center font-black text-white">${formatMoney(item.price)}</div>
                    </div>
                `).join('') || '<div class="col-span-full text-center text-gray-500 py-10 font-bold uppercase">≈Ω√°dn√© voln√© skiny.</div>';
            } else {
                document.getElementById('selector-title').textContent = "VYBER C√çLOV√ù SKIN";
                let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
                let targets = Object.values(skinsDB).filter(s => s.price > totalVal);
                const sortMode = document.getElementById('selector-sort')?.value || 'price-low';
                if(sortMode === 'price-high') targets.sort((a,b)=>b.price-a.price);
                else if(sortMode === 'name') targets.sort((a,b)=>a.name.localeCompare(b.name));
                else targets.sort((a,b)=>a.price-b.price);
                grid.innerHTML = targets.map((item, idx) => `
                    <div onclick="upgTarget = skinsDB[${item.id}]; switchPage('upgrade');" class="bg-[#1a1e26] p-4 rounded-xl cursor-pointer hover:bg-gray-800 transition-all border-b-4 item-float" style="border-color: ${item.color}; animation-delay: ${idx * 50}ms;">
                        <img src="${item.img}" onerror="handleImgError(this)" class="h-20 w-full object-contain mb-3 drop-shadow-md hover:scale-110 transition-transform">
                        <div class="text-[10px] text-center truncate font-bold text-gray-400 uppercase">${item.name}</div>
                        <div class="text-sm text-center font-black text-white">${formatMoney(item.price)}</div>
                        <div class="text-[10px] text-center font-bold text-purple-400 mt-1">≈†ance: ${Math.min((totalVal / item.price)*100, 90).toFixed(1)}%</div>
                    </div>
                `).join('') || '<div class="col-span-full text-center text-gray-500 py-10 font-bold uppercase">Nejprve p≈ôidej sv√© skiny.</div>';
            }
        }

        function attemptUpgrade() {
            if(isSpinning) return;
            let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
            if(totalVal === 0) return showToast("Vlo≈æ alespo≈à jeden skin!", true);
            if(!upgTarget) return showToast("Vyber c√≠lov√Ω skin!", true);

            isSpinning = true;
            document.getElementById('btn-upgrade-exec').textContent = "Vylep≈°uji...";
            document.getElementById('upgrade-panel').classList.add('upgrade-shake');
            
            // Zvuk napƒõt√≠
            const soundNode = SoundEngine.playUpgradeProcess();

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('upgrade-panel').classList.remove('upgrade-shake');
                document.getElementById('btn-upgrade-exec').textContent = "Vylep≈°it";
                if(soundNode) { soundNode.gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1); }

                let chance = Math.min((totalVal / upgTarget.price) * 100, 90);
                const roll = Math.random() * 100;
                
                upgInputs.forEach(item => { if(item) { userInventory.splice(userInventory.findIndex(i => i.uid === item.uid), 1); } });

                if (roll <= chance) {
                    showWinModal(upgTarget);
                } else {
                    SoundEngine.playUpgradeFail();
                    showToast("Upgrade selhal. Skiny sho≈ôely.", true);
                }

                upgInputs = [null, null, null];
                upgTarget = null;
                renderUpgrader();
            }, 2000);
        }

        window.onload = () => { 
            lucide.createIcons();
            switchPage('cases');
            try {
                const raw = localStorage.getItem('otodropProfile');
                if(raw) {
                    const parsed = JSON.parse(raw);
                    if(parsed && parsed.nickname) userProfile = { ...userProfile, ...parsed };
                }
            } catch(e) { console.warn('profile load failed', e); }
            // Inicializuj live drops + chat (fail-safe)
            try { initializeLiveDrops(); } catch(e) { console.error('live drops init failed', e); }
            try { simulateLiveChat(); } catch(e) { console.error('live chat init failed', e); }
            // Currency selector handler
            const cur = document.getElementById('currency-select');
            if(cur) {
                cur.addEventListener('change', updateUI);
            }
            const modal = document.getElementById('auth-modal');
            if(modal) {
                modal.addEventListener('click', (e) => {
                    if(e.target === modal) closeAuthModal();
                });
            }
            // Inicialn√≠ UI update
            updateUI();
        };

        // --- Live chat (u≈æivatel + AI odpovƒõdi, fallback bez API) ---
        async function maybeGeminiReply(userMessage) {
            const apiKey = localStorage.getItem('geminiApiKey') || '';
            if(!apiKey) return null;
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Jsi kr√°tk√Ω chat hr√°ƒçe CS2. Odpovƒõz jednou vƒõtou ƒçesky na zpr√°vu: ${userMessage}` }] }],
                        generationConfig: { maxOutputTokens: 40, temperature: 0.9 }
                    })
                });
                if(!res.ok) return null;
                const data = await res.json();
                return data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || null;
            } catch {
                return null;
            }
        }

        function initializeLiveDrops() {
            const dropsContainer = document.getElementById('live-drops');
            if(!dropsContainer) return;
            dropsContainer.style.animation = 'none';
            const skinList = Object.values(skinsDB);
            const cheapPool = skinList.filter(s => s.price <= 15);
            const midPool = skinList.filter(s => s.price > 15 && s.price <= 120);
            const expensivePool = skinList.filter(s => s.price > 120 && s.price <= 700);
            const ultraPool = skinList.filter(s => s.price > 700 || KNIFE_TYPES.includes(s.weapon) || GLOVE_TYPES.includes(s.weapon));

            function pickWeightedLiveSkin() {
                const roll = Math.random() * 100;
                let pool = cheapPool;
                // Realistiƒçtƒõj≈°√≠ feed: drtiv√° vƒõt≈°ina drop≈Ø je levn√°, drah√©/no≈æe jsou vz√°cn√©
                if(roll < 82) pool = cheapPool;
                else if(roll < 95) pool = midPool.length ? midPool : cheapPool;
                else if(roll < 99.2) pool = expensivePool.length ? expensivePool : (midPool.length ? midPool : cheapPool);
                else pool = ultraPool.length ? ultraPool : (expensivePool.length ? expensivePool : cheapPool);
                return pool[Math.floor(Math.random() * pool.length)] || skinList[Math.floor(Math.random() * skinList.length)];
            }
            let lastSkinId = null;
            let offsetX = 0;
            let paused = false;

            const steamProfiles = [
                { name: 'Alpha', avatar: 'https://avatars.steamstatic.com/3474acf231388ba5b11d5eba255a07596726a9e4_full.jpg' },
                { name: 'Beta', avatar: 'https://avatars.steamstatic.com/1a53bfabad2d39907942792a942ccfdb5f3df269_full.jpg' },
                { name: 'Gamer', avatar: 'https://cdn.casehug.com/bots/bot-gadget.gif' },
                { name: 'Pro', avatar: 'https://cdn.casehug.com/bots/bot-jarvis.gif' },
                { name: 'Lucky', avatar: 'https://cdn.casehug.com/bots/bot-poke_1.png' },
                { name: 'Hunter', avatar: 'https://avatars.steamstatic.com/5a3b1d7d7d2f3a2b4e_full.jpg' },
                { name: 'Trader', avatar: 'https://avatars.steamstatic.com/6b8f3c2d2d2a3b1c4f_full.jpg' },
                { name: 'Baller', avatar: 'https://avatars.steamstatic.com/8c7d9f4a4a4b5c6d7e_full.jpg' }
            ];

            function addRandomDrop() {
                if(skinList.length === 0) return;
                let attempts = 0;
                let randomSkin = pickWeightedLiveSkin();
                while(randomSkin.id === lastSkinId && attempts < 8 && skinList.length > 1) {
                    randomSkin = pickWeightedLiveSkin();
                    attempts++;
                }
                lastSkinId = randomSkin.id;

                const profile = steamProfiles[Math.floor(Math.random() * steamProfiles.length)];
                const item = document.createElement('div');
                item.className = 'live-drop-item';

                const avatarWrap = document.createElement('div');
                avatarWrap.className = 'live-drop-avatar';
                const avatarImg = document.createElement('img');
                avatarImg.src = profile.avatar;
                avatarImg.alt = profile.name;
                avatarImg.style.width = '100%'; avatarImg.style.height = '100%'; avatarImg.style.objectFit = 'cover';
                avatarImg.onerror = handleImgError;
                avatarWrap.appendChild(avatarImg);

                const img = document.createElement('img');
                img.src = randomSkin.img;
                img.alt = randomSkin.name;
                if(randomSkin.imgAlts) img.dataset.alts = randomSkin.imgAlts.join('|');
                img.onerror = handleImgError;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'live-drop-item-name';
                nameDiv.textContent = randomSkin.name;

                const userDiv = document.createElement('div');
                userDiv.className = 'live-drop-item-user';
                userDiv.textContent = `${profile.name}#${Math.floor(Math.random()*9999)}`;

                const tooltip = document.createElement('div');
                tooltip.className = 'live-drop-tooltip';
                tooltip.innerHTML = `
                    <div class="tp-row">
                        <div class="tp-avatar"><img src="${profile.avatar}" style="width:100%;height:100%;object-fit:cover;" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'"></div>
                        <div>
                            <div class="tp-name">${profile.name}</div>
                            <div class="tp-when">Vyhr√°lo: ${randomSkin.name}</div>
                        </div>
                    </div>
                `;

                item.appendChild(avatarWrap);
                item.appendChild(img);
                item.appendChild(nameDiv);
                item.appendChild(userDiv);
                item.appendChild(tooltip);

                item.addEventListener('mouseenter', () => { paused = true; tooltip.classList.add('visible'); item.style.zIndex = '100'; });
                item.addEventListener('mouseleave', () => { paused = false; tooltip.classList.remove('visible'); item.style.zIndex = '1'; });

                dropsContainer.appendChild(item);
                if(dropsContainer.children.length > 60) dropsContainer.removeChild(dropsContainer.firstChild);
            }

            for(let i=0;i<18;i++) addRandomDrop();
            setInterval(addRandomDrop, 1700);
            setInterval(() => {
                if(dropsContainer.children.length < 6) {
                    for(let i=0;i<12;i++) addRandomDrop();
                }
            }, 4000);

            let lastTs = performance.now();
            const speed = 34;
            const gapPx = 16;
            function getItemWidth(el) {
                if(!el) return 0;
                return (el.offsetWidth || el.getBoundingClientRect().width || 0) + gapPx;
            }
            function animate(ts) {
                const dt = Math.min(0.05, (ts - lastTs) / 1000);
                lastTs = ts;
                if(!paused) {
                    offsetX -= speed * dt;
                    let first = dropsContainer.firstElementChild;
                    let firstWidth = getItemWidth(first);
                    while(first && firstWidth > 0 && -offsetX >= firstWidth) {
                        offsetX += firstWidth;
                        dropsContainer.appendChild(first);
                        first = dropsContainer.firstElementChild;
                        firstWidth = getItemWidth(first);
                    }
                    dropsContainer.style.transform = `translate3d(${offsetX}px,0,0)`;
                }
                requestAnimationFrame(animate);
            }
            requestAnimationFrame(animate);
        }

        function simulateLiveChat() {
            const container = document.getElementById('live-chat-messages');
            const input = document.getElementById('live-chat-input');
            const sendBtn = document.getElementById('live-chat-send');
            if(!container || !input || !sendBtn) return;

            const firstNames = ['Marek','Dominik','Nela','Tomas','Vojta','Luky','Kiki','Radek','Stepan','Niki','Milan','Pavel','Fanda','Kuba','Jana','Erik','Misa','Roman','Patrik','Alex'];
            const intros = ['pr√°vƒõ', 'teƒè', 'dneska', 'up≈ô√≠mnƒõ', 'lol', 'ngl', 'wtf', 'bro', 'tyjo', 'mega'];
            const actions = ['dropnul', 'vyt√°hl', 'sp√°lil', 'otoƒçil', 'prodal', 'nechal v invu', 'p≈ôidal do upgradu', 'zkusil free case', 'risknul all-in'];
            const items = ['Karambit Fade', 'M4A4 Howl', 'AWP Asiimov', 'AK-47 Bloodsport', 'Sport Gloves Vice', 'Desert Eagle Printstream', 'Butterfly Doppler', 'M9 Tiger Tooth', 'AWP Dragon Lore', 'USP-S Neo-Noir'];
            const reactions = ['to je ≈°√≠len√Ω', 'tohle bol√≠', 'dneska to pad√°', 'rip bankroll', 'easy profit', 'casino mƒõ miluje', 'casino mƒõ nen√°vid√≠', 'toƒç√≠m d√°l', 'jdu je≈°tƒõ jednu'];
            const emotes = ['üî•','üíÄ','üòé','üòÇ','üéØ','üí∏','üßä','üëÄ','üöÄ','ü§Ø'];

            const addMessage = (name, message, mine = false) => {
                const row = document.createElement('div');
                row.className = mine ? 'text-[12px] text-right' : 'text-[12px]';
                row.innerHTML = mine
                    ? `<span class="text-yellow-300 font-bold">Ty:</span> <span class="text-white">${message}</span>`
                    : `<span class="text-yellow-300 font-bold">${name}:</span> <span class="text-gray-300">${message}</span>`;
                container.appendChild(row);
                if(container.children.length > 120) container.removeChild(container.firstChild);
                container.scrollTop = container.scrollHeight;
            };

            const randomName = () => `${firstNames[Math.floor(Math.random()*firstNames.length)]}#${1000 + Math.floor(Math.random()*9000)}`;
            const randomEmotes = () => Array.from({length: 1 + Math.floor(Math.random()*2)}, () => emotes[Math.floor(Math.random()*emotes.length)]).join('');
            const generateHumanLikeMessage = () => {
                const i = intros[Math.floor(Math.random()*intros.length)];
                const a = actions[Math.floor(Math.random()*actions.length)];
                const it = items[Math.floor(Math.random()*items.length)];
                const r = reactions[Math.floor(Math.random()*reactions.length)];
                const patterns = [
                    `${i} jsem ${a} ${it} ${randomEmotes()}`,
                    `${a} jsem ${it}, ${r} ${randomEmotes()}`,
                    `${i} free case a ${a} ${it}`,
                    `${it}? ${r} ${randomEmotes()}`,
                    `${i} toƒç√≠m ${a} a ${r}`
                ];
                return patterns[Math.floor(Math.random() * patterns.length)];
            };

            const pushNaturalMessage = () => addMessage(randomName(), generateHumanLikeMessage());

            const sendUserMessage = () => {
                const text = input.value.trim();
                if(!text) return;
                input.value = '';
                addMessage('Ty', text, true);
                maybeGeminiReply(text).then((ai) => {
                    if(ai) addMessage(randomName(), ai);
                    else setTimeout(() => pushNaturalMessage(), 450 + Math.random()*1400);
                });
            };

            sendBtn.onclick = sendUserMessage;
            input.addEventListener('keydown', (e) => { if(e.key === 'Enter') sendUserMessage(); });

            for(let i=0;i<12;i++) setTimeout(pushNaturalMessage, i*220);
            setInterval(pushNaturalMessage, 1200 + Math.random()*1900);
        }

        // --- FREE CASE SYSTEM ---
        // --- FREE CASE SYSTEM ---
        const FREE_CASE_COOLDOWN = 24 * 60 * 60 * 1000; // 24 hodin
        
        function getFreeCaseStatus() {
            const lastFreeCase = localStorage.getItem('lastFreeCase');
            if(!lastFreeCase) return { available: true, nextTime: 0 };
            
            const lastTime = parseInt(lastFreeCase);
            const now = Date.now();
            const nextTime = lastTime + FREE_CASE_COOLDOWN;
            
            return {
                available: now >= nextTime,
                nextTime: Math.max(0, Math.ceil((nextTime - now) / 1000))
            };
        }

        function openFreeCase() {
            const status = getFreeCaseStatus();
            if(!status.available) {
                const hours = Math.floor(status.nextTime / 3600);
                const mins = Math.floor((status.nextTime % 3600) / 60);
                showToast(`Dal≈°√≠ FREE bedna za ${hours}h ${mins}m`, true);
                return;
            }

            // Otevri n√°hodnou bednu
            const randomCase = casesDB[Math.floor(Math.random() * casesDB.length)];
            localStorage.setItem('lastFreeCase', Date.now().toString());
            
            // Bez poplatku
            activeCaseId = randomCase.id;
            document.getElementById('view-case-name').textContent = randomCase.name + ' (FREE)';
            document.getElementById('view-case-price').textContent = '0 EUR';
            
            const countSel = document.getElementById('open-count');
            if(countSel) {
                countSel.value = '1';
                countSel.disabled = false;
            }
            ensureSpinnerRows(1, randomCase);
            const results = document.getElementById('spin-results');
            if(results) results.innerHTML = '';
            
            document.getElementById('view-case-contents').innerHTML = randomCase.contents.map(item => `
                <div class="bg-gray-900/50 p-3 rounded-xl border-b-2 flex flex-col items-center text-center" style="border-color: ${item.skin.color}">
                    <img src="${item.skin.img}" data-alts="${(item.skin.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-16 object-contain mb-2 drop-shadow-md">
                    <div class="text-[9px] font-bold text-gray-400 uppercase truncate w-full">${item.skin.name}</div>
                    <div class="text-[10px] font-black text-white">${item.chance}%</div>
                </div>
            `).join('');

            const btn = document.getElementById('btn-open-case');
            btn.onclick = () => spinCase(randomCase, getOpenCount());
            btn.textContent = "OTEV≈ò√çT ZDARMA";
            btn.disabled = false;
            btn.classList.remove('opacity-50');

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-case-view').classList.remove('hidden');
            
            showToast('FREE bedna dostupn√°!');
        }
    </script>
</body>
</html> 
